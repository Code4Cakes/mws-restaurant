"use strict";var restaurant,newMap;document.addEventListener("DOMContentLoaded",function(e){initMap()});var initMap=function(){fetchRestaurantFromURL(function(e,t){e||(self.newMap=L.map("map",{center:[t.latlng.lat,t.latlng.lng],zoom:16,scrollWheelZoom:!1}),L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token={mapboxToken}",{mapboxToken:"pk.eyJ1IjoiYnJhZHl0Zm9yZCIsImEiOiJjamlydTVnZngwMXlhM3dxbTE2NzNhbWNjIn0.vP54TruwPoPWQLYZdPKcug",maxZoom:18,id:"mapbox.streets"}).addTo(newMap),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.newMap)),document.querySelector("img.leaflet-marker-icon").setAttribute("aria-label","")})},fetchRestaurantFromURL=function(r){if(self.restaurant)r(null,self.restaurant);else{var t=getParameterByName("id");t?DBHelper.fetchRestaurantById(t,function(e,n){(self.restaurant=n)&&DBHelper.fetchReviewsByRestaurantId(t,function(e,t){self.restaurant.reviews=t,fillRestaurantHTML(),r(null,n)})}):(error="No restaurant id in URL",r(error,null))}},fillRestaurantHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant;document.getElementById("restaurant-name").innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=e.address;var t=document.getElementById("restaurant-img");t.className="restaurant-img",t.alt=DBHelper.imageAltforRestaurant(e),t.src=DBHelper.imageUrlForRestaurant(e),document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML()},fillRestaurantHoursHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant.operating_hours,t=document.getElementById("restaurant-hours");for(var n in e){var r=document.createElement("tr"),a=document.createElement("td");a.innerHTML=n,r.appendChild(a);var i=document.createElement("td");i.innerHTML=e[n],r.appendChild(i),t.appendChild(r)}},fillReviewsHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant.reviews,t=document.getElementById("reviews-container"),n=document.createElement("div");n.setAttribute("id","titleBox");var r=document.createElement("h2");if(r.innerHTML="Reviews",n.append(r),t.prepend(n),!e){var a=document.createElement("p");return a.innerHTML="No reviews yet!",void n.appendChild(a)}for(var i=document.getElementById("reviews-list");i.firstChild;)i.removeChild(i.firstChild);e.forEach(function(e){i.appendChild(createReviewHTML(e))}),i.appendChild(createForm()),t.appendChild(i)},createReviewHTML=function(e){var t=document.createElement("article");t.setAttribute("tabindex",0);var n=document.createElement("h3");n.innerHTML=e.name,t.appendChild(n);var r=document.createElement("p");r.innerHTML=new Date(e.updatedAt).toLocaleString(),t.appendChild(r);var a=document.createElement("p");a.innerHTML="Rating: ".concat(e.rating),t.appendChild(a);var i=document.createElement("p");return i.innerHTML=e.comments,t.appendChild(i),t},fillBreadcrumb=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant,t=document.getElementById("breadcrumb"),n=document.createElement("li");n.innerHTML=e.name,t.appendChild(n)},getParameterByName=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]".concat(e,"(=([^&#]*)|&|#|$)")).exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null},createForm=function(){var e=document.createElement("article"),t=document.createElement("h2");t.innerHTML="Missing your favorite spot?",e.append(t);var n=document.createElement("h3");n.innerHTML="Add a restaurant to our listings below.",e.append(n);var r=document.createElement("form");r.setAttribute("action","javascript:void(0)"),r.setAttribute("onsubmit","submitReview()");var a=document.createElement("div"),i=document.createElement("label");i.innerHTML="Your Name",i.setAttribute("for","reviewerName"),a.append(i);var u=document.createElement("input");u.setAttribute("type","text"),u.setAttribute("name","reviewerName"),u.setAttribute("id","reviewerName"),u.setAttribute("required","required"),a.append(u),r.append(a);var d=document.createElement("div"),l=document.createElement("label");l.innerHTML="Rating (1-5)",l.setAttribute("for","newReviewRating"),d.append(l);var m=document.createElement("input");m.setAttribute("type","number"),m.setAttribute("min","1"),m.setAttribute("max","5"),m.setAttribute("name","newReviewRating"),m.setAttribute("id","newReviewRating"),m.setAttribute("required","required"),d.append(m),r.append(d);var o=document.createElement("div"),s=document.createElement("label");s.innerHTML="Comments",s.setAttribute("for","newReviewComments"),o.append(s);var c=document.createElement("textarea");c.setAttribute("name","newReviewComments"),c.setAttribute("id","newReviewComments"),c.setAttribute("rows","5"),c.setAttribute("required","required"),o.append(c),r.append(o);var p=document.createElement("button");return p.setAttribute("type","submit"),p.innerHTML="Submit",r.append(p),e.append(r),e},submitReview=function(){var e={id:self.restaurant.reviews.length+1,restaurant_id:self.restaurant.id,name:document.getElementById("reviewerName").value,createdAt:new Date,rating:parseInt(document.getElementById("newReviewRating").value),comments:document.getElementById("newReviewComments").value};DBHelper.addReviews(e),self.restaurant.reviews.push(e),fillReviewsHTML()};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlc3RhdXJhbnRfaW5mby5qcyJdLCJuYW1lcyI6WyJyZXN0YXVyYW50IiwibmV3TWFwIiwiZG9jdW1lbnQiLCJhZGRFdmVudExpc3RlbmVyIiwiZXZlbnQiLCJpbml0TWFwIiwiZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCIsImVycm9yIiwic2VsZiIsIkwiLCJtYXAiLCJjZW50ZXIiLCJsYXRsbmciLCJsYXQiLCJsbmciLCJ6b29tIiwic2Nyb2xsV2hlZWxab29tIiwidGlsZUxheWVyIiwibWFwYm94VG9rZW4iLCJtYXhab29tIiwiaWQiLCJhZGRUbyIsImZpbGxCcmVhZGNydW1iIiwiREJIZWxwZXIiLCJtYXBNYXJrZXJGb3JSZXN0YXVyYW50IiwicXVlcnlTZWxlY3RvciIsInNldEF0dHJpYnV0ZSIsImNhbGxiYWNrIiwiZ2V0UGFyYW1ldGVyQnlOYW1lIiwiZmV0Y2hSZXN0YXVyYW50QnlJZCIsImZldGNoUmV2aWV3c0J5UmVzdGF1cmFudElkIiwicmV2aWV3cyIsImZpbGxSZXN0YXVyYW50SFRNTCIsImFyZ3VtZW50cyIsImxlbmd0aCIsInVuZGVmaW5lZCIsImdldEVsZW1lbnRCeUlkIiwiaW5uZXJIVE1MIiwibmFtZSIsImFkZHJlc3MiLCJpbWFnZSIsImNsYXNzTmFtZSIsImFsdCIsImltYWdlQWx0Zm9yUmVzdGF1cmFudCIsInNyYyIsImltYWdlVXJsRm9yUmVzdGF1cmFudCIsImN1aXNpbmVfdHlwZSIsIm9wZXJhdGluZ19ob3VycyIsImZpbGxSZXN0YXVyYW50SG91cnNIVE1MIiwiZmlsbFJldmlld3NIVE1MIiwib3BlcmF0aW5nSG91cnMiLCJob3VycyIsImtleSIsInJvdyIsImNyZWF0ZUVsZW1lbnQiLCJkYXkiLCJhcHBlbmRDaGlsZCIsInRpbWUiLCJjb250YWluZXIiLCJ0aXRsZUJveCIsInRpdGxlIiwiYXBwZW5kIiwicHJlcGVuZCIsIm5vUmV2aWV3cyIsInVsIiwiZmlyc3RDaGlsZCIsInJlbW92ZUNoaWxkIiwiZm9yRWFjaCIsInJldmlldyIsImNyZWF0ZVJldmlld0hUTUwiLCJjcmVhdGVGb3JtIiwibGkiLCJkYXRlIiwiRGF0ZSIsInVwZGF0ZWRBdCIsInRvTG9jYWxlU3RyaW5nIiwicmF0aW5nIiwiY29uY2F0IiwiY29tbWVudHMiLCJicmVhZGNydW1iIiwidXJsIiwid2luZG93IiwibG9jYXRpb24iLCJocmVmIiwicmVwbGFjZSIsInJlc3VsdHMiLCJSZWdFeHAiLCJleGVjIiwiZGVjb2RlVVJJQ29tcG9uZW50IiwiYXJ0aWNsZSIsImhlYWRpbmciLCJzdWJoZWFkaW5nIiwiZm9ybSIsImRpdjEiLCJsYWJlbDEiLCJpbnB1dDEiLCJkaXYyIiwibGFiZWwyIiwiaW5wdXQyIiwiZGl2MyIsImxhYmVsMyIsImlucHV0MyIsImJ1dHRvbiIsInN1Ym1pdFJldmlldyIsInBhcmFtcyIsInJlc3RhdXJhbnRfaWQiLCJ2YWx1ZSIsImNyZWF0ZWRBdCIsInBhcnNlSW50IiwiYWRkUmV2aWV3cyIsInB1c2giXSwibWFwcGluZ3MiOiJhQUFBLElBQUlBLFdBQ0FDLE9BS0pDLFNBQVNDLGlCQUFpQixtQkFBb0IsU0FBQUMsR0FDNUNDLFlBTUYsSUFBSUEsUUFBVSxXQUNaQyx1QkFBdUIsU0FBQ0MsRUFBT1AsR0FDekJPLElBSUZDLEtBQUtQLE9BQVNRLEVBQUVDLElBQUksTUFBTyxDQUN6QkMsT0FBUSxDQUFDWCxFQUFXWSxPQUFPQyxJQUFLYixFQUFXWSxPQUFPRSxLQUNsREMsS0FBTSxHQUNOQyxpQkFBaUIsSUFFbkJQLEVBQUVRLFVBQ0Esb0ZBQ0EsQ0FDRUMsWUFDRSxnR0FDRkMsUUFBUyxHQUNUQyxHQUFJLG1CQUVOQyxNQUFNcEIsUUFDUnFCLGlCQUNBQyxTQUFTQyx1QkFBdUJoQixLQUFLUixXQUFZUSxLQUFLUCxTQUd4REMsU0FDR3VCLGNBQWMsMkJBQ2RDLGFBQWEsYUFBYyxPQU85QnBCLHVCQUF5QixTQUFBcUIsR0FDM0IsR0FBSW5CLEtBQUtSLFdBRVAyQixFQUFTLEtBQU1uQixLQUFLUixnQkFGdEIsQ0FLQSxJQUFNb0IsRUFB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UTVCLE9BQU8rQixHQUVSSCxHQUdMYyxhQUFlLFdBQ2pCLElBQUlDLEVBQVMsQ0FDWHBGLEdBQUlaLEtBQUtSLFdBQVcrQixRQUFRRyxPQUFTLEVBQ3JDdUUsY0FBZWpHLEtBQUtSLFdBQVdvQixHQUMvQmtCLEtBQU1wQyxTQUFTa0MsZUFBZSxnQkFBZ0JzRSxNQUM5Q0MsVUFBVyxJQUFJbEMsS0FDZkcsT0FBUWdDLFNBQVMxRyxTQUFTa0MsZUFBZSxtQkFBbUJzRSxPQUM1RDVCLFNBQVU1RSxTQUFTa0MsZUFBZSxxQkFBcUJzRSxPQUd6RG5GLFNBQVNzRixXQUFXTCxHQUNwQmhHLEtBQUtSLFdBQVcrQixRQUFRK0UsS0FBS04sR0FDN0J2RCIsImZpbGUiOiJyZXN0YXVyYW50X2luZm8ubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsibGV0IHJlc3RhdXJhbnRcbnZhciBuZXdNYXBcblxuLyoqXG4gKiBJbml0aWFsaXplIG1hcCBhcyBzb29uIGFzIHRoZSBwYWdlIGlzIGxvYWRlZC5cbiAqL1xuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGV2ZW50ID0+IHtcbiAgaW5pdE1hcCgpXG59KVxuXG4vKipcbiAqIEluaXRpYWxpemUgbGVhZmxldCBtYXBcbiAqL1xubGV0IGluaXRNYXAgPSAoKSA9PiB7XG4gIGZldGNoUmVzdGF1cmFudEZyb21VUkwoKGVycm9yLCByZXN0YXVyYW50KSA9PiB7XG4gICAgaWYgKGVycm9yKSB7XG4gICAgICAvLyBHb3QgYW4gZXJyb3IhXG4gICAgICAvLyBjb25zb2xlLmVycm9yKGVycm9yKVxuICAgIH0gZWxzZSB7XG4gICAgICBzZWxmLm5ld01hcCA9IEwubWFwKCdtYXAnLCB7XG4gICAgICAgIGNlbnRlcjogW3Jlc3RhdXJhbnQubGF0bG5nLmxhdCwgcmVzdGF1cmFudC5sYXRsbmcubG5nXSxcbiAgICAgICAgem9vbTogMTYsXG4gICAgICAgIHNjcm9sbFdoZWVsWm9vbTogZmFsc2VcbiAgICAgIH0pXG4gICAgICBMLnRpbGVMYXllcihcbiAgICAgICAgJ2h0dHBzOi8vYXBpLnRpbGVzLm1hcGJveC5jb20vdjQve2lkfS97en0ve3h9L3t5fS5qcGc3MD9hY2Nlc3NfdG9rZW49e21hcGJveFRva2VufScsXG4gICAgICAgIHtcbiAgICAgICAgICBtYXBib3hUb2tlbjpcbiAgICAgICAgICAgICdway5leUoxSWpvaVluSmhaSGwwWm05eVpDSXNJbUVpT2lKamFtbHlkVFZuWm5nd01YbGhNM2R4YlRFMk56TmhiV05qSW4wLnZQNTRUcnV3UG9QV1FMWVpkUEtjdWcnLFxuICAgICAgICAgIG1heFpvb206IDE4LFxuICAgICAgICAgIGlkOiAnbWFwYm94LnN0cmVldHMnXG4gICAgICAgIH1cbiAgICAgICkuYWRkVG8obmV3TWFwKVxuICAgICAgZmlsbEJyZWFkY3J1bWIoKVxuICAgICAgREJIZWxwZXIubWFwTWFya2VyRm9yUmVzdGF1cmFudChzZWxmLnJlc3RhdXJhbnQsIHNlbGYubmV3TWFwKVxuICAgIH1cblxuICAgIGRvY3VtZW50XG4gICAgICAucXVlcnlTZWxlY3RvcignaW1nLmxlYWZsZXQtbWFya2VyLWljb24nKVxuICAgICAgLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsICcnKVxuICB9KVxufVxuXG4vKipcbiAqIEdldCBjdXJyZW50IHJlc3RhdXJhbnQgZnJvbSBwYWdlIFVSTC5cbiAqL1xubGV0IGZldGNoUmVzdGF1cmFudEZyb21VUkwgPSBjYWxsYmFjayA9PiB7XG4gIGlmIChzZWxmLnJlc3RhdXJhbnQpIHtcbiAgICAvLyByZXN0YXVyYW50IGFscmVhZHkgZmV0Y2hlZCFcbiAgICBjYWxsYmFjayhudWxsLCBzZWxmLnJlc3RhdXJhbnQpXG4gICAgcmV0dXJuXG4gIH1cbiAgY29uc3QgaWQgPSBnZXRQYXJhbWV0ZXJCeU5hbWUoJ2lkJylcbiAgaWYgKCFpZCkge1xuICAgIC8vIG5vIGlkIGZvdW5kIGluIFVSTFxuICAgIGVycm9yID0gJ05vIHJlc3RhdXJhbnQgaWQgaW4gVVJMJ1xuICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKVxuICB9IGVsc2Uge1xuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudEJ5SWQoaWQsIChlcnJvciwgcmVzdGF1cmFudCkgPT4ge1xuICAgICAgc2VsZi5yZXN0YXVyYW50ID0gcmVzdGF1cmFudFxuICAgICAgaWYgKCFyZXN0YXVyYW50KSB7XG4gICAgICAgIC8vIGNvbnNvbGUuZXJyb3IoZXJyb3IpXG4gICAgICAgIHJldHVyblxuICAgICAgfVxuICAgICAgREJIZWxwZXIuZmV0Y2hSZXZpZXdzQnlSZXN0YXVyYW50SWQoaWQsIChlcnJvciwgcmV2aWV3cykgPT4ge1xuICAgICAgICBzZWxmLnJlc3RhdXJhbnQucmV2aWV3cyA9IHJldmlld3NcbiAgICAgICAgZmlsbFJlc3RhdXJhbnRIVE1MKClcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudClcbiAgICAgIH0pXG4gICAgfSlcbiAgfVxufVxuXG4vKipcbiAqIENyZWF0ZSByZXN0YXVyYW50IEhUTUwgYW5kIGFkZCBpdCB0byB0aGUganBnYWdlXG4gKi9cbmxldCBmaWxsUmVzdGF1cmFudEhUTUwgPSAocmVzdGF1cmFudCA9IHNlbGYucmVzdGF1cmFudCkgPT4ge1xuICBjb25zdCBuYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtbmFtZScpXG4gIG5hbWUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lXG5cbiAgY29uc3QgYWRkcmVzcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWFkZHJlc3MnKVxuICBhZGRyZXNzLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuYWRkcmVzc1xuXG4gIGNvbnN0IGltYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtaW1nJylcbiAgaW1hZ2UuY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnQtaW1nJ1xuICBpbWFnZS5hbHQgPSBEQkhlbHBlci5pbWFnZUFsdGZvclJlc3RhdXJhbnQocmVzdGF1cmFudClcbiAgaW1hZ2Uuc3JjID0gREJIZWxwZXIuaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpXG5cbiAgY29uc3QgY3Vpc2luZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWN1aXNpbmUnKVxuICBjdWlzaW5lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuY3Vpc2luZV90eXBlXG5cbiAgLy8gZmlsbCBvcGVyYXRpbmcgaG91cnNcbiAgaWYgKHJlc3RhdXJhbnQub3BlcmF0aW5nX2hvdXJzKSB7XG4gICAgZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwoKVxuICB9XG4gIC8vIGZpbGwgcmV2aWV3c1xuICBmaWxsUmV2aWV3c0hUTUwoKVxufVxuXG4vKipcbiAqIENyZWF0ZSByZXN0YXVyYW50IG9wZXJhdGluZyBob3VycyBIVE1MIHRhYmxlIGFuZCBhZGQgaXQgdG8gdGhlIHBhZ2UuXG4gKi9cbmxldCBmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCA9IChcbiAgb3BlcmF0aW5nSG91cnMgPSBzZWxmLnJlc3RhdXJhbnQub3BlcmF0aW5nX2hvdXJzXG4pID0+IHtcbiAgY29uc3QgaG91cnMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1ob3VycycpXG4gIGZvciAobGV0IGtleSBpbiBvcGVyYXRpbmdIb3Vycykge1xuICAgIGNvbnN0IHJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJylcblxuICAgIGNvbnN0IGRheSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJylcbiAgICBkYXkuaW5uZXJIVE1MID0ga2V5XG4gICAgcm93LmFwcGVuZENoaWxkKGRheSlcblxuICAgIGNvbnN0IHRpbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpXG4gICAgdGltZS5pbm5lckhUTUwgPSBvcGVyYXRpbmdIb3Vyc1trZXldXG4gICAgcm93LmFwcGVuZENoaWxkKHRpbWUpXG5cbiAgICBob3Vycy5hcHBlbmRDaGlsZChyb3cpXG4gIH1cbn1cblxuLyoqXG4gKiBDcmVhdGUgYWxsIHJldmlld3MgSFRNTCBhbmQgYWRkIHRoZW0gdG8gdGhlIGpwZ2FnZS5cbiAqL1xubGV0IGZpbGxSZXZpZXdzSFRNTCA9IChyZXZpZXdzID0gc2VsZi5yZXN0YXVyYW50LnJldmlld3MpID0+IHtcblxuICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3cy1jb250YWluZXInKVxuICBjb25zdCB0aXRsZUJveCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpXG4gIHRpdGxlQm94LnNldEF0dHJpYnV0ZSgnaWQnLCAndGl0bGVCb3gnKVxuICBjb25zdCB0aXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gyJylcbiAgdGl0bGUuaW5uZXJIVE1MID0gJ1Jldmlld3MnXG4gIHRpdGxlQm94LmFwcGVuZCh0aXRsZSlcbiAgY29udGFpbmVyLnByZXBlbmQodGl0bGVCb3gpXG5cbiAgaWYgKCFyZXZpZXdzKSB7XG4gICAgY29uc3Qgbm9SZXZpZXdzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpXG4gICAgbm9SZXZpZXdzLmlubmVySFRNTCA9ICdObyByZXZpZXdzIHlldCEnXG4gICAgdGl0bGVCb3guYXBwZW5kQ2hpbGQobm9SZXZpZXdzKVxuICAgIHJldHVyblxuICB9XG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtbGlzdCcpXG4gIHdoaWxlICh1bC5maXJzdENoaWxkKSB1bC5yZW1vdmVDaGlsZCh1bC5maXJzdENoaWxkKVxuICByZXZpZXdzLmZvckVhY2gocmV2aWV3ID0+IHtcbiAgICB1bC5hcHBlbmRDaGlsZChjcmVhdGVSZXZpZXdIVE1MKHJldmlldykpXG4gIH0pXG4gIHVsLmFwcGVuZENoaWxkKGNyZWF0ZUZvcm0oKSlcbiAgY29udGFpbmVyLmFwcGVuZENoaWxkKHVsKVxufVxuXG4vKipcbiAqIENyZWF0ZSByZXZpZXcgSFRNTCBhbmQgYWRkIGl0IHRvIHRoZSBqcGdhZ2UuXG4gKi9cbmxldCBjcmVhdGVSZXZpZXdIVE1MID0gcmV2aWV3ID0+IHtcbiAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhcnRpY2xlJylcbiAgbGkuc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsIDApXG4gIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMycpXG4gIG5hbWUuaW5uZXJIVE1MID0gcmV2aWV3Lm5hbWVcbiAgbGkuYXBwZW5kQ2hpbGQobmFtZSlcblxuICBjb25zdCBkYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpXG4gIGRhdGUuaW5uZXJIVE1MID0gbmV3IERhdGUocmV2aWV3LnVwZGF0ZWRBdCkudG9Mb2NhbGVTdHJpbmcoKVxuICBsaS5hcHBlbmRDaGlsZChkYXRlKVxuXG4gIGNvbnN0IHJhdGluZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKVxuICByYXRpbmcuaW5uZXJIVE1MID0gYFJhdGluZzogJHtyZXZpZXcucmF0aW5nfWBcbiAgbGkuYXBwZW5kQ2hpbGQocmF0aW5nKVxuXG4gIGNvbnN0IGNvbW1lbnRzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpXG4gIGNvbW1lbnRzLmlubmVySFRNTCA9IHJldmlldy5jb21tZW50c1xuICBsaS5hcHBlbmRDaGlsZChjb21tZW50cylcblxuICByZXR1cm4gbGlcbn1cblxuLyoqXG4gKiBBZGQgcmVzdGF1cmFudCBuYW1lIHRvIHRoZSBicmVhZGNydW1iIG5hdmlnYXRpb24gbWVudVxuICovXG5sZXQgZmlsbEJyZWFkY3J1bWIgPSAocmVzdGF1cmFudCA9IHNlbGYucmVzdGF1cmFudCkgPT4ge1xuICBjb25zdCBicmVhZGNydW1iID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JyZWFkY3J1bWInKVxuICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJylcbiAgbGkuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lXG4gIGJyZWFkY3J1bWIuYXBwZW5kQ2hpbGQobGkpXG59XG5cbi8qKlxuICogR2V0IGEgcGFyYW1ldGVyIGJ5IG5hbWUgZnJvbSBwYWdlIFVSTC5cbiAqL1xubGV0IGdldFBhcmFtZXRlckJ5TmFtZSA9IChuYW1lLCB1cmwpID0+IHtcbiAgaWYgKCF1cmwpIHVybCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmXG4gIG5hbWUgPSBuYW1lLnJlcGxhY2UoL1tcXFtcXF1dL2csICdcXFxcJCYnKVxuICBjb25zdCByZWdleCA9IG5ldyBSZWdFeHAoYFs/Jl0ke25hbWV9KD0oW14mI10qKXwmfCN8JClgKSxcbiAgICByZXN1bHRzID0gcmVnZXguZXhlYyh1cmwpXG4gIGlmICghcmVzdWx0cykgcmV0dXJuIG51bGxcbiAgaWYgKCFyZXN1bHRzWzJdKSByZXR1cm4gJydcbiAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChyZXN1bHRzWzJdLnJlcGxhY2UoL1xcKy9nLCAnICcpKVxufVxuXG4vKipcbiAqQ3JlYXRlIGZvcm0gdGlsZS5cbiAqL1xubGV0IGNyZWF0ZUZvcm0gPSAoKSA9PiB7XG4gIGNvbnN0IGFydGljbGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhcnRpY2xlJylcblxuICAvL0hlYWRlclxuICBjb25zdCBoZWFkaW5nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDInKVxuICBoZWFkaW5nLmlubmVySFRNTCA9ICdNaXNzaW5nIHlvdXIgZmF2b3JpdGUgc3BvdD8nXG4gIGFydGljbGUuYXBwZW5kKGhlYWRpbmcpXG4gIGNvbnN0IHN1YmhlYWRpbmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMycpXG4gIHN1YmhlYWRpbmcuaW5uZXJIVE1MID0gJ0FkZCBhIHJlc3RhdXJhbnQgdG8gb3VyIGxpc3RpbmdzIGJlbG93LidcbiAgYXJ0aWNsZS5hcHBlbmQoc3ViaGVhZGluZylcblxuICAvL0Zvcm1cbiAgY29uc3QgZm9ybSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2Zvcm0nKVxuICBmb3JtLnNldEF0dHJpYnV0ZSgnYWN0aW9uJywgJ2phdmFzY3JpcHQ6dm9pZCgwKScpXG4gIGZvcm0uc2V0QXR0cmlidXRlKCdvbnN1Ym1pdCcsICdzdWJtaXRSZXZpZXcoKScpXG5cbiAgLy9GaXJzdCBJbnB1dFxuICBjb25zdCBkaXYxID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JylcblxuICBjb25zdCBsYWJlbDEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsYWJlbCcpXG4gIGxhYmVsMS5pbm5lckhUTUwgPSAnWW91ciBOYW1lJ1xuICBsYWJlbDEuc2V0QXR0cmlidXRlKCdmb3InLCAncmV2aWV3ZXJOYW1lJylcbiAgZGl2MS5hcHBlbmQobGFiZWwxKVxuXG4gIGNvbnN0IGlucHV0MSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0JylcbiAgaW5wdXQxLnNldEF0dHJpYnV0ZSgndHlwZScsICd0ZXh0JylcbiAgaW5wdXQxLnNldEF0dHJpYnV0ZSgnbmFtZScsICdyZXZpZXdlck5hbWUnKVxuICBpbnB1dDEuc2V0QXR0cmlidXRlKCdpZCcsICdyZXZpZXdlck5hbWUnKVxuICBpbnB1dDEuc2V0QXR0cmlidXRlKCdyZXF1aXJlZCcsICdyZXF1aXJlZCcpXG4gIGRpdjEuYXBwZW5kKGlucHV0MSlcblxuICBmb3JtLmFwcGVuZChkaXYxKVxuXG4gIC8vU2Vjb25kIElucHV0XG4gIGNvbnN0IGRpdjIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKVxuXG4gIGNvbnN0IGxhYmVsMiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xhYmVsJylcbiAgbGFiZWwyLmlubmVySFRNTCA9ICdSYXRpbmcgKDEtNSknXG4gIGxhYmVsMi5zZXRBdHRyaWJ1dGUoJ2ZvcicsICduZXdSZXZpZXdSYXRpbmcnKVxuICBkaXYyLmFwcGVuZChsYWJlbDIpXG5cbiAgY29uc3QgaW5wdXQyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKVxuICBpbnB1dDIuc2V0QXR0cmlidXRlKCd0eXBlJywgJ251bWJlcicpXG4gIGlucHV0Mi5zZXRBdHRyaWJ1dGUoJ21pbicsICcxJylcbiAgaW5wdXQyLnNldEF0dHJpYnV0ZSgnbWF4JywgJzUnKVxuICBpbnB1dDIuc2V0QXR0cmlidXRlKCduYW1lJywgJ25ld1Jldmlld1JhdGluZycpXG4gIGlucHV0Mi5zZXRBdHRyaWJ1dGUoJ2lkJywgJ25ld1Jldmlld1JhdGluZycpXG4gIGlucHV0Mi5zZXRBdHRyaWJ1dGUoJ3JlcXVpcmVkJywgJ3JlcXVpcmVkJylcbiAgZGl2Mi5hcHBlbmQoaW5wdXQyKVxuXG4gIGZvcm0uYXBwZW5kKGRpdjIpXG5cbiAgLy9MYXN0IFVzZXIgSW5wdXRcbiAgY29uc3QgZGl2MyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpXG5cbiAgY29uc3QgbGFiZWwzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGFiZWwnKVxuICBsYWJlbDMuaW5uZXJIVE1MID0gJ0NvbW1lbnRzJ1xuICBsYWJlbDMuc2V0QXR0cmlidXRlKCdmb3InLCAnbmV3UmV2aWV3Q29tbWVudHMnKVxuICBkaXYzLmFwcGVuZChsYWJlbDMpXG5cbiAgY29uc3QgaW5wdXQzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGV4dGFyZWEnKVxuICBpbnB1dDMuc2V0QXR0cmlidXRlKCduYW1lJywgJ25ld1Jldmlld0NvbW1lbnRzJylcbiAgaW5wdXQzLnNldEF0dHJpYnV0ZSgnaWQnLCAnbmV3UmV2aWV3Q29tbWVudHMnKVxuICBpbnB1dDMuc2V0QXR0cmlidXRlKCdyb3dzJywgJzUnKVxuICBpbnB1dDMuc2V0QXR0cmlidXRlKCdyZXF1aXJlZCcsICdyZXF1aXJlZCcpXG4gIGRpdjMuYXBwZW5kKGlucHV0MylcblxuICBmb3JtLmFwcGVuZChkaXYzKVxuXG4gIC8vc3VibWl0IGJ1dHRvblxuICBjb25zdCBidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKVxuICBidXR0b24uc2V0QXR0cmlidXRlKCd0eXBlJywgJ3N1Ym1pdCcpXG4gIGJ1dHRvbi5pbm5lckhUTUwgPSAnU3VibWl0J1xuXG4gIGZvcm0uYXBwZW5kKGJ1dHRvbilcblxuICBhcnRpY2xlLmFwcGVuZChmb3JtKVxuXG4gIHJldHVybiBhcnRpY2xlXG59XG5cbmxldCBzdWJtaXRSZXZpZXcgPSAoKSA9PiB7XG4gIGxldCBwYXJhbXMgPSB7XG4gICAgaWQ6IHNlbGYucmVzdGF1cmFudC5yZXZpZXdzLmxlbmd0aCArIDEsXG4gICAgcmVzdGF1cmFudF9pZDogc2VsZi5yZXN0YXVyYW50LmlkLFxuICAgIG5hbWU6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdlck5hbWUnKS52YWx1ZSxcbiAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgcmF0aW5nOiBwYXJzZUludChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmV3UmV2aWV3UmF0aW5nJykudmFsdWUpLFxuICAgIGNvbW1lbnRzOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmV3UmV2aWV3Q29tbWVudHMnKS52YWx1ZVxuICB9XG5cbiAgREJIZWxwZXIuYWRkUmV2aWV3cyhwYXJhbXMpXG4gIHNlbGYucmVzdGF1cmFudC5yZXZpZXdzLnB1c2gocGFyYW1zKVxuICBmaWxsUmV2aWV3c0hUTUwoKVxuXG59Il19
