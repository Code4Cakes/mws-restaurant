"use strict";var restaurants,neighborhoods,cuisines,newMap,db,markers=[],fetchNeighborhoods=function(){DBHelper.fetchNeighborhoods(function(e,t){e||(self.neighborhoods=t,fillNeighborhoodsHTML())})},fillNeighborhoodsHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.neighborhoods,n=document.getElementById("neighborhoods-select");e.forEach(function(e){var t=document.createElement("option");t.innerHTML=e,t.value=e,n.append(t)})},fetchCuisines=function(){DBHelper.fetchCuisines(function(e,t){e||(self.cuisines=t,fillCuisinesHTML())})},fillCuisinesHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.cuisines,n=document.getElementById("cuisines-select");e.forEach(function(e){var t=document.createElement("option");t.innerHTML=e,t.value=e,n.append(t)})},initMap=function(){self.newMap=L.map("map",{center:[40.722216,-73.987501],zoom:12,scrollWheelZoom:!1}),L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token={mapboxToken}",{mapboxToken:"pk.eyJ1IjoiYnJhZHl0Zm9yZCIsImEiOiJjamlydTVnZngwMXlhM3dxbTE2NzNhbWNjIn0.vP54TruwPoPWQLYZdPKcug",maxZoom:18,id:"mapbox.streets"}).addTo(newMap),updateRestaurants()},updateRestaurants=function(){var e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),n=e.selectedIndex,a=t.selectedIndex,r=e[n].value,o=t[a].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(r,o,function(e,t){e||(resetRestaurants(t),fillRestaurantsHTML())})},resetRestaurants=function(e){self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers&&self.markers.forEach(function(e){return e.remove()}),self.markers=[],self.restaurants=e},fillRestaurantsHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurants,t=document.getElementById("restaurants-list");e.forEach(function(e){t.append(createRestaurantHTML(e))}),addMarkersToMap()},createRestaurantHTML=function(e){var t=document.createElement("article");t.setAttribute("id","restaurant-".concat(e.id));var n=document.createElement("img");n.className="restaurant-img",n.src=DBHelper.imageUrlForRestaurant(e),n.alt=DBHelper.imageAltforRestaurant(e),t.append(n);var a=document.createElement("header"),r=document.createElement("h2"),o=document.createElement("span"),s=!0===e.is_favorite?"star favorite":"star";o.setAttribute("onclick","toggleFavorite('restaurant-".concat(e.id,"')")),o.setAttribute("class",s),r.innerHTML=e.name,r.append(o),a.appendChild(r),t.append(a);var i=document.createElement("p");i.innerHTML=e.neighborhood,t.append(i);var l=document.createElement("p");l.innerHTML=e.address,t.append(l);var c=document.createElement("a");return c.innerHTML="View Details",c.href=DBHelper.urlForRestaurant(e),c.setAttribute("role","button"),t.append(c),t},addMarkersToMap=function(){(0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurants).forEach(function(e){var t=DBHelper.mapMarkerForRestaurant(e,self.newMap);function n(){window.location.href=t.options.url}t.on("click",n),t.on("keydown",function(e){alert(),event.preventDefault(),13===e.keyCode&&n()}),self.markers.push(t)}),document.querySelectorAll("img.leaflet-marker-icon").forEach(function(e){e.setAttribute("role","link")})},toggleFavorite=function(e){var t=document.querySelector("#".concat(e," .star"));-1!==t.className.indexOf("favorite")?(t.className="star",DBHelper.sendToggleFav(e.slice(-1),"false")):(t.className="star favorite",DBHelper.sendToggleFav(e.slice(-1),"true"))};document.addEventListener("DOMContentLoaded",function(e){initMap(),fetchNeighborhoods(),fetchCuisines()});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsicmVzdGF1cmFudHMiLCJuZWlnaGJvcmhvb2RzIiwiY3Vpc2luZXMiLCJuZXdNYXAiLCJkYiIsIm1hcmtlcnMiLCJmZXRjaE5laWdoYm9yaG9vZHMiLCJEQkhlbHBlciIsImVycm9yIiwic2VsZiIsImZpbGxOZWlnaGJvcmhvb2RzSFRNTCIsImFyZ3VtZW50cyIsImxlbmd0aCIsInVuZGVmaW5lZCIsInNlbGVjdCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJmb3JFYWNoIiwibmVpZ2hib3Job29kIiwib3B0aW9uIiwiY3JlYXRlRWxlbWVudCIsImlubmVySFRNTCIsInZhbHVlIiwiYXBwZW5kIiwiZmV0Y2hDdWlzaW5lcyIsImZpbGxDdWlzaW5lc0hUTUwiLCJjdWlzaW5lIiwiaW5pdE1hcCIsIkwiLCJtYXAiLCJjZW50ZXIiLCJ6b29tIiwic2Nyb2xsV2hlZWxab29tIiwidGlsZUxheWVyIiwibWFwYm94VG9rZW4iLCJtYXhab29tIiwiaWQiLCJhZGRUbyIsInVwZGF0ZVJlc3RhdXJhbnRzIiwiY1NlbGVjdCIsIm5TZWxlY3QiLCJjSW5kZXgiLCJzZWxlY3RlZEluZGV4IiwibkluZGV4IiwiZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kIiwicmVzZXRSZXN0YXVyYW50cyIsImZpbGxSZXN0YXVyYW50c0hUTUwiLCJtYXJrZXIiLCJyZW1vdmUiLCJ1bCIsInJlc3RhdXJhbnQiLCJjcmVhdGVSZXN0YXVyYW50SFRNTCIsImFkZE1hcmtlcnNUb01hcCIsImFydCIsInNldEF0dHJpYnV0ZSIsImNvbmNhdCIsImltYWdlIiwiY2xhc3NOYW1lIiwic3JjIiwiaW1hZ2VVcmxGb3JSZXN0YXVyYW50IiwiYWx0IiwiaW1hZ2VBbHRmb3JSZXN0YXVyYW50IiwiaGVhZGVyIiwibmFtZSIsInN0YXIiLCJjbGFzc1N0cmluZyIsImlzX2Zhdm9yaXRlIiwiYXBwZW5kQ2hpbGQiLCJhZGRyZXNzIiwibW9yZSIsImhyZWYiLCJ1cmxGb3JSZXN0YXVyYW50IiwibWFwTWFya2VyRm9yUmVzdGF1cmFudCIsIm9uQ2xpY2siLCJ3aW5kb3ciLCJsb2NhdGlvbiIsIm9wdGlvbnMiLCJ1cmwiLCJvbiIsImUiLCJhbGVydCIsImV2ZW50IiwicHJldmVudERlZmF1bHQiLCJrZXlDb2RlIiwicHVzaCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJlbGVtIiwidG9nZ2xlRmF2b3JpdGUiLCJ0aGlzU3RhciIsInF1ZXJ5U2VsZWN0b3IiLCJpbmRleE9mIiwic2VuZFRvZ2dsZUZhdiIsInNsaWNlIiwiYWRkRXZlbnRMaXN0ZW5lciJdLCJtYXBwaW5ncyI6ImFBQUEsSUFBSUEsWUFDRkMsY0FDQUMsU0FDQUMsT0FFQUMsR0FEQUMsUUFBVSxHQU1SQyxtQkFBcUIsV0FDdkJDLFNBQVNELG1CQUFtQixTQUFDRSxFQUFPUCxHQUM5Qk8sSUFJRkMsS0FBS1IsY0FBZ0JBLEVBQ3JCUyw0QkFRRkEsc0JBQXdCLFdBQXdDLElBQXZDVCxFQUF1QyxFQUFBVSxVQUFBQyxhQUFBQyxJQUFBRixVQUFBLEdBQUFBLFVBQUEsR0FBdkJGLEtBQUtSLGNBQzFDYSxFQUFTQyxTQUFTQyxlQUFlLHdCQUN2Q2YsRUFBY2dCLFFBQVEsU0FBQUMsR0FDcEIsSUFBTUMsRUFBU0osU0FBU0ssY0FBYyxVQUN0Q0QsRUFBT0UsVUFBWUgsRUFDbkJDLEVBQU9HLE1BQVFKLEVBQ2ZKLEVBQU9TLE9BQU9KLE1BT2RLLGNBQWdCLFdBQ2xCakIsU0FBU2lCLGNBQWMsU0FBQ2hCLEVBQU9OLEdBQ3pCTSxJQUlGQyxLQUFLUCxTQUFXQSxFQUNoQnVCLHVCQVFGQSxpQkFBbUIsV0FBOEIsSUFBN0J2QixFQUE2QixFQUFBUyxVQUFBQyxhQUFBQyxJQUFBRixVQUFBLEdBQUFBLFVBQUEsR0FBbEJGLEtBQUtQLFNBQ2hDWSxFQUFTQyxTQUFTQyxlQUFlLG1CQUV2Q2QsRUFBU2UsUUFBUSxTQUFBUyxHQUNmLElBQU1QLEVBQVNKLFNBQVNLLGNBQWMsVUFDdENELEVBQU9FLFVBQVlL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QUFRQyxJQUZ4QzlCLEVBQU8rQixHQUFHLFFBQVNMLEdBSW5CMUIsRUFBTytCLEdBQUcsVUFBVyxTQUFBQyxHQUNuQkMsUUFDQUMsTUFBTUMsaUJBQ1ksS0FBZEgsRUFBRUksU0FBZ0JWLE1BRXhCaEUsS0FBS0osUUFBUStFLEtBQUtyQyxLQUVwQmhDLFNBQVNzRSxpQkFBaUIsMkJBQTJCcEUsUUFBUSxTQUFBcUUsR0FDM0RBLEVBQUtoQyxhQUFhLE9BQVEsV0FJMUJpQyxlQUFpQixTQUFDbkQsR0FDcEIsSUFBSW9ELEVBQVd6RSxTQUFTMEUsY0FBVCxJQUFBbEMsT0FBMkJuQixFQUEzQixZQUNpQyxJQUE1Q29ELEVBQVMvQixVQUFVaUMsUUFBUSxhQUM3QkYsRUFBUy9CLFVBQVksT0FDckJsRCxTQUFTb0YsY0FBY3ZELEVBQUd3RCxPQUFPLEdBQUksV0FFckNKLEVBQVMvQixVQUFZLGdCQUNyQmxELFNBQVNvRixjQUFjdkQsRUFBR3dELE9BQU8sR0FBSSxVQVF6QzdFLFNBQVM4RSxpQkFBaUIsbUJBQW9CLFNBQUFaLEdBQzVDdEQsVUFDQXJCLHFCQUNBa0IiLCJmaWxlIjoibWFpbi5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJsZXQgcmVzdGF1cmFudHMsXHJcbiAgbmVpZ2hib3Job29kcyxcclxuICBjdWlzaW5lcyxcclxuICBuZXdNYXAsXHJcbiAgbWFya2VycyA9IFtdLFxyXG4gIGRiXHJcblxyXG4vKipcclxuICogRmV0Y2ggYWxsIG5laWdoYm9yaG9vZHMgYW5kIHNldCB0aGVpciBIVE1MLlxyXG4gKi9cclxubGV0IGZldGNoTmVpZ2hib3Job29kcyA9ICgpID0+IHtcclxuICBEQkhlbHBlci5mZXRjaE5laWdoYm9yaG9vZHMoKGVycm9yLCBuZWlnaGJvcmhvb2RzKSA9PiB7XHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgLy8gR290IGFuIGVycm9yXHJcbiAgICAgIC8vIGNvbnNvbGUuZXJyb3IoZXJyb3IpXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBzZWxmLm5laWdoYm9yaG9vZHMgPSBuZWlnaGJvcmhvb2RzXHJcbiAgICAgIGZpbGxOZWlnaGJvcmhvb2RzSFRNTCgpXHJcbiAgICB9XHJcbiAgfSlcclxufVxyXG5cclxuLyoqXHJcbiAqIFNldCBuZWlnaGJvcmhvb2RzIEhUTUwuXHJcbiAqL1xyXG5sZXQgZmlsbE5laWdoYm9yaG9vZHNIVE1MID0gKG5laWdoYm9yaG9vZHMgPSBzZWxmLm5laWdoYm9yaG9vZHMpID0+IHtcclxuICBjb25zdCBzZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmVpZ2hib3Job29kcy1zZWxlY3QnKVxyXG4gIG5laWdoYm9yaG9vZHMuZm9yRWFjaChuZWlnaGJvcmhvb2QgPT4ge1xyXG4gICAgY29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJylcclxuICAgIG9wdGlvbi5pbm5lckhUTUwgPSBuZWlnaGJvcmhvb2RcclxuICAgIG9wdGlvbi52YWx1ZSA9IG5laWdoYm9yaG9vZFxyXG4gICAgc2VsZWN0LmFwcGVuZChvcHRpb24pXHJcbiAgfSlcclxufVxyXG5cclxuLyoqXHJcbiAqIEZldGNoIGFsbCBjdWlzaW5lcyBhbmQgc2V0IHRoZWlyIEhUTUwuXHJcbiAqL1xyXG5sZXQgZmV0Y2hDdWlzaW5lcyA9ICgpID0+IHtcclxuICBEQkhlbHBlci5mZXRjaEN1aXNpbmVzKChlcnJvciwgY3Vpc2luZXMpID0+IHtcclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICAvLyBHb3QgYW4gZXJyb3IhXHJcbiAgICAgIC8vIGNvbnNvbGUuZXJyb3IoZXJyb3IpXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBzZWxmLmN1aXNpbmVzID0gY3Vpc2luZXNcclxuICAgICAgZmlsbEN1aXNpbmVzSFRNTCgpXHJcbiAgICB9XHJcbiAgfSlcclxufVxyXG5cclxuLyoqXHJcbiAqIFNldCBjdWlzaW5lcyBIVE1MLlxyXG4gKi9cclxubGV0IGZpbGxDdWlzaW5lc0hUTUwgPSAoY3Vpc2luZXMgPSBzZWxmLmN1aXNpbmVzKSA9PiB7XHJcbiAgY29uc3Qgc2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1aXNpbmVzLXNlbGVjdCcpXHJcblxyXG4gIGN1aXNpbmVzLmZvckVhY2goY3Vpc2luZSA9PiB7XHJcbiAgICBjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKVxyXG4gICAgb3B0aW9uLmlubmVySFRNTCA9IGN1aXNpbmVcclxuICAgIG9wdGlvbi52YWx1ZSA9IGN1aXNpbmVcclxuICAgIHNlbGVjdC5hcHBlbmQob3B0aW9uKVxyXG4gIH0pXHJcbn1cclxuXHJcbi8qKlxyXG4gKiBJbml0aWFsaXplIGxlYWZsZXQgbWFwLCBjYWxsZWQgZnJvbSBIVE1MLlxyXG4gKi9cclxubGV0IGluaXRNYXAgPSAoKSA9PiB7XHJcbiAgc2VsZi5uZXdNYXAgPSBMLm1hcCgnbWFwJywge1xyXG4gICAgY2VudGVyOiBbNDAuNzIyMjE2LCAtNzMuOTg3NTAxXSxcclxuICAgIHpvb206IDEyLFxyXG4gICAgc2Nyb2xsV2hlZWxab29tOiBmYWxzZVxyXG4gIH0pXHJcbiAgTC50aWxlTGF5ZXIoXHJcbiAgICAnaHR0cHM6Ly9hcGkudGlsZXMubWFwYm94LmNvbS92NC97aWR9L3t6fS97eH0ve3l9LmpwZzcwP2FjY2Vzc190b2tlbj17bWFwYm94VG9rZW59JyxcclxuICAgIHtcclxuICAgICAgbWFwYm94VG9rZW46XHJcbiAgICAgICAgJ3BrLmV5SjFJam9pWW5KaFpIbDBabTl5WkNJc0ltRWlPaUpqYW1seWRUVm5abmd3TVhsaE0zZHhiVEUyTnpOaGJXTmpJbjAudlA1NFRydXdQb1BXUUxZWmRQS2N1ZycsXHJcbiAgICAgIG1heFpvb206IDE4LFxyXG4gICAgICBpZDogJ21hcGJveC5zdHJlZXRzJ1xyXG4gICAgfVxyXG4gICkuYWRkVG8obmV3TWFwKVxyXG5cclxuICB1cGRhdGVSZXN0YXVyYW50cygpXHJcbn1cclxuXHJcbi8qKlxyXG4gKiBVcGRhdGUgcGFnZSBhbmQgbWFwIGZvciBjdXJyZW50IHJlc3RhdXJhbnRzLlxyXG4gKi9cclxubGV0IHVwZGF0ZVJlc3RhdXJhbnRzID0gKCkgPT4ge1xyXG4gIGNvbnN0IGNTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3Vpc2luZXMtc2VsZWN0JylcclxuICBjb25zdCBuU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25laWdoYm9yaG9vZHMtc2VsZWN0JylcclxuXHJcbiAgY29uc3QgY0luZGV4ID0gY1NlbGVjdC5zZWxlY3RlZEluZGV4XHJcbiAgY29uc3QgbkluZGV4ID0gblNlbGVjdC5zZWxlY3RlZEluZGV4XHJcblxyXG4gIGNvbnN0IGN1aXNpbmUgPSBjU2VsZWN0W2NJbmRleF0udmFsdWVcclxuICBjb25zdCBuZWlnaGJvcmhvb2QgPSBuU2VsZWN0W25JbmRleF0udmFsdWVcclxuXHJcbiAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kKFxyXG4gICAgY3Vpc2luZSxcclxuICAgIG5laWdoYm9yaG9vZCxcclxuICAgIChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgLy8gR290IGFuIGVycm9yIVxyXG4gICAgICAgIC8vIGNvbnNvbGUuZXJyb3IoZXJyb3IpXHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmVzZXRSZXN0YXVyYW50cyhyZXN0YXVyYW50cylcclxuICAgICAgICBmaWxsUmVzdGF1cmFudHNIVE1MKClcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIClcclxufVxyXG5cclxuLyoqXHJcbiAqIENsZWFyIGN1cnJlbnQgcmVzdGF1cmFudHMsIHRoZWlyIEhUTUwgYW5kIHJlbW92ZSB0aGVpciBtYXAgbWFya2Vycy5cclxuICovXHJcbmxldCByZXNldFJlc3RhdXJhbnRzID0gcmVzdGF1cmFudHMgPT4ge1xyXG4gIC8vIFJlbW92ZSBhbGwgcmVzdGF1cmFudHNcclxuICBzZWxmLnJlc3RhdXJhbnRzID0gW11cclxuICBjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50cy1saXN0JylcclxuICB1bC5pbm5lckhUTUwgPSAnJ1xyXG5cclxuICAvLyBSZW1vdmUgYWxsIG1hcCBtYXJrZXJzXHJcbiAgaWYgKHNlbGYubWFya2Vycykge1xyXG4gICAgc2VsZi5tYXJrZXJzLmZvckVhY2gobWFya2VyID0+IG1hcmtlci5yZW1vdmUoKSlcclxuICB9XHJcbiAgc2VsZi5tYXJrZXJzID0gW11cclxuICBzZWxmLnJlc3RhdXJhbnRzID0gcmVzdGF1cmFudHNcclxufVxyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSBhbGwgcmVzdGF1cmFudHMgSFRNTCBhbmQgYWRkIHRoZW0gdG8gdGhlIGpwZ2FnZS5cclxuICovXHJcbmxldCBmaWxsUmVzdGF1cmFudHNIVE1MID0gKHJlc3RhdXJhbnRzID0gc2VsZi5yZXN0YXVyYW50cykgPT4ge1xyXG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnRzLWxpc3QnKVxyXG4gIHJlc3RhdXJhbnRzLmZvckVhY2gocmVzdGF1cmFudCA9PiB7XHJcbiAgICB1bC5hcHBlbmQoY3JlYXRlUmVzdGF1cmFudEhUTUwocmVzdGF1cmFudCkpXHJcbiAgfSlcclxuICBhZGRNYXJrZXJzVG9NYXAoKVxyXG59XHJcblxyXG4vKipcclxuICogQ3JlYXRlIHJlc3RhdXJhbnQgSFRNTC5cclxuICovXHJcbmxldCBjcmVhdGVSZXN0YXVyYW50SFRNTCA9IHJlc3RhdXJhbnQgPT4ge1xyXG4gIGNvbnN0IGFydCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2FydGljbGUnKVxyXG4gIGFydC5zZXRBdHRyaWJ1dGUoJ2lkJywgYHJlc3RhdXJhbnQtJHtyZXN0YXVyYW50LmlkfWApXHJcblxyXG4gIGNvbnN0IGltYWdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJylcclxuICBpbWFnZS5jbGFzc05hbWUgPSAncmVzdGF1cmFudC1pbWcnXHJcbiAgaW1hZ2Uuc3JjID0gREJIZWxwZXIuaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpXHJcbiAgaW1hZ2UuYWx0ID0gREJIZWxwZXIuaW1hZ2VBbHRmb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpXHJcbiAgYXJ0LmFwcGVuZChpbWFnZSlcclxuXHJcbiAgY29uc3QgaGVhZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaGVhZGVyJylcclxuICBjb25zdCBuYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDInKVxyXG4gIGNvbnN0IHN0YXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJylcclxuICBjb25zdCBjbGFzc1N0cmluZyA9IHJlc3RhdXJhbnQuaXNfZmF2b3JpdGUgPT09IHRydWUgPyAnc3RhciBmYXZvcml0ZScgOiAnc3RhcidcclxuICBzdGFyLnNldEF0dHJpYnV0ZSgnb25jbGljaycsIGB0b2dnbGVGYXZvcml0ZShcXCdyZXN0YXVyYW50LSR7cmVzdGF1cmFudC5pZH1cXCcpYClcclxuICBzdGFyLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCBjbGFzc1N0cmluZylcclxuICBuYW1lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZVxyXG4gIG5hbWUuYXBwZW5kKHN0YXIpXHJcbiAgaGVhZGVyLmFwcGVuZENoaWxkKG5hbWUpXHJcbiAgYXJ0LmFwcGVuZChoZWFkZXIpXHJcblxyXG4gIGNvbnN0IG5laWdoYm9yaG9vZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKVxyXG4gIG5laWdoYm9yaG9vZC5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5laWdoYm9yaG9vZFxyXG4gIGFydC5hcHBlbmQobmVpZ2hib3Job29kKVxyXG5cclxuICBjb25zdCBhZGRyZXNzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpXHJcbiAgYWRkcmVzcy5pbm5lckhUTUwgPSByZXN0YXVyYW50LmFkZHJlc3NcclxuICBhcnQuYXBwZW5kKGFkZHJlc3MpXHJcblxyXG4gIGNvbnN0IG1vcmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJylcclxuICBtb3JlLmlubmVySFRNTCA9ICdWaWV3IERldGFpbHMnXHJcbiAgbW9yZS5ocmVmID0gREJIZWxwZXIudXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KVxyXG4gIG1vcmUuc2V0QXR0cmlidXRlKCdyb2xlJywgJ2J1dHRvbicpXHJcblxyXG4gIGFydC5hcHBlbmQobW9yZSlcclxuXHJcbiAgcmV0dXJuIGFydFxyXG59XHJcblxyXG4vKipcclxuICogQWRkIG1hcmtlcnMgZm9yIGN1cnJlbnQgcmVzdGF1cmFudHMgdG8gdGhlIG1hcC5cclxuICovXHJcbmxldCBhZGRNYXJrZXJzVG9NYXAgPSAocmVzdGF1cmFudHMgPSBzZWxmLnJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgcmVzdGF1cmFudHMuZm9yRWFjaChyZXN0YXVyYW50ID0+IHtcclxuICAgIC8vIEFkZCBtYXJrZXIgdG8gdGhlIG1hcFxyXG4gICAgY29uc3QgbWFya2VyID0gREJIZWxwZXIubWFwTWFya2VyRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCBzZWxmLm5ld01hcClcclxuICAgIG1hcmtlci5vbignY2xpY2snLCBvbkNsaWNrKVxyXG4gICAgZnVuY3Rpb24gb25DbGljaygpIHtcclxuICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBtYXJrZXIub3B0aW9ucy51cmxcclxuICAgIH1cclxuICAgIG1hcmtlci5vbigna2V5ZG93bicsIGUgPT4ge1xyXG4gICAgICBhbGVydCgpXHJcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KClcclxuICAgICAgaWYgKGUua2V5Q29kZSA9PT0gMTMpIG9uQ2xpY2soKVxyXG4gICAgfSlcclxuICAgIHNlbGYubWFya2Vycy5wdXNoKG1hcmtlcilcclxuICB9KVxyXG4gIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2ltZy5sZWFmbGV0LW1hcmtlci1pY29uJykuZm9yRWFjaChlbGVtID0+IHtcclxuICAgIGVsZW0uc2V0QXR0cmlidXRlKCdyb2xlJywgJ2xpbmsnKVxyXG4gIH0pXHJcbn1cclxuXHJcbmxldCB0b2dnbGVGYXZvcml0ZSA9IChpZCkgPT4ge1xyXG4gIGxldCB0aGlzU3RhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCMke2lkfSAuc3RhcmApXHJcbiAgaWYgKHRoaXNTdGFyLmNsYXNzTmFtZS5pbmRleE9mKCdmYXZvcml0ZScpICE9PSAtMSkge1xyXG4gICAgdGhpc1N0YXIuY2xhc3NOYW1lID0gJ3N0YXInXHJcbiAgICBEQkhlbHBlci5zZW5kVG9nZ2xlRmF2KGlkLnNsaWNlKC0xKSwgJ2ZhbHNlJylcclxuICB9IGVsc2Uge1xyXG4gICAgdGhpc1N0YXIuY2xhc3NOYW1lID0gJ3N0YXIgZmF2b3JpdGUnXHJcbiAgICBEQkhlbHBlci5zZW5kVG9nZ2xlRmF2KGlkLnNsaWNlKC0xKSwgJ3RydWUnKVxyXG4gIH1cclxuXHJcbn1cclxuXHJcbi8qKlxyXG4gKiBGZXRjaCBuZWlnaGJvcmhvb2RzIGFuZCBjdWlzaW5lcyBhcyBzb29uIGFzIHRoZSBwYWdlIGlzIGxvYWRlZC5cclxuICovXHJcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBldmVudCA9PiB7XHJcbiAgaW5pdE1hcCgpIC8vIGFkZGVkXHJcbiAgZmV0Y2hOZWlnaGJvcmhvb2RzKClcclxuICBmZXRjaEN1aXNpbmVzKClcclxufSkiXX0=
