"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,n,t){return n&&_defineProperties(e.prototype,n),t&&_defineProperties(e,t),e}var DBHelper=function(){function o(){_classCallCheck(this,o)}return _createClass(o,null,[{key:"fetchRestaurants",value:function(t){fetch("".concat(o.DATABASE_URL,"/restaurants")).then(function(e){if(200===e.status)e.json().then(function(e){t(null,e)});else{var n="Request failed. Returned status of ".concat(xhr.status);t(n,null)}}).catch(function(e){})}},{key:"fetchReviews",value:function(t){fetch("".concat(o.DATABASE_URL,"/reviews")).then(function(e){if(200===e.status)e.json().then(function(e){t(null,e)});else{var n="Request failed. Returned status of ".concat(xhr.status);t(n,null)}}).catch(function(e){})}},{key:"fetchRestaurantById",value:function(a,u){o.fetchRestaurants(function(e,n){if(e)u(e,null);else{var t=n.find(function(e){return e.id==a});t?u(null,t):u("Restaurant does not exist",null)}})}},{key:"fetchReviewsByRestaurantId",value:function(e,t){fetch("".concat(o.DATABASE_URL,"/reviews/?restaurant_id=").concat(e)).then(function(e){if(200===e.status)e.json().then(function(e){t(null,e)});else{var n="Request failed. Returned status of ".concat(xhr.status);t(n,null)}}).catch(function(e){})}},{key:"fetchRestaurantByCuisine",value:function(a,u){o.fetchRestaurants(function(e,n){if(e)u(e,null);else{var t=n.filter(function(e){return e.cuisine_type==a});u(null,t)}})}},{key:"fetchRestaurantByNeighborhood",value:function(a,u){o.fetchRestaurants(function(e,n){if(e)u(e,null);else{var t=n.filter(function(e){return e.neighborhood==a});u(null,t)}})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(a,u,r){o.fetchRestaurants(function(e,n){if(e)r(e,null);else{var t=n;"all"!=a&&(t=t.filter(function(e){return e.cuisine_type==a})),"all"!=u&&(t=t.filter(function(e){return e.neighborhood==u})),r(null,t)}})}},{key:"fetchNeighborhoods",value:function(u){o.fetchRestaurants(function(e,t){if(e)u(e,null);else{var a=t.map(function(e,n){return t[n].neighborhood}),n=a.filter(function(e,n){return a.indexOf(e)==n});u(null,n)}})}},{key:"fetchCuisines",value:function(u){o.fetchRestaurants(function(e,t){if(e)u(e,null);else{var a=t.map(function(e,n){return t[n].cuisine_type}),n=a.filter(function(e,n){return a.indexOf(e)==n});u(null,n)}})}},{key:"urlForRestaurant",value:function(e){return"./restaurant.html?id=".concat(e.id)}},{key:"imageUrlForRestaurant",value:function(e){return"public/img/".concat(e.id,".jpg")}},{key:"imageAltforRestaurant",value:function(e){return e.imageAlt}},{key:"mapMarkerForRestaurant",value:function(e,n){var t=new L.marker([e.latlng.lat,e.latlng.lng],{title:e.name,alt:e.name,url:o.urlForRestaurant(e)});return t.addTo(newMap),t}},{key:"sendToggleFav",value:function(e,n){(new Headers).append("Content-Type","application/json");var t="http://localhost:1337/restaurants/".concat(e,"/?is_favorite=").concat(n);this.sendRequest(t,{method:"PUT",mode:"cors",cache:"no-cache",credentials:"same-origin"})}},{key:"addReviews",value:function(e){var n=new Headers;n.append("Content-Type","application/json");var t={method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:n,body:JSON.stringify(e)};this.sendRequest("http://localhost:1337/reviews/",t)}},{key:"sendRequest",value:function(e,n){fetch(e,n).then(function(e){if(!e.ok)throw Error(e.statusText);return e.json()}).then(function(e){console.log("Sent",e)}).catch(function(e){return console.log("Failed",e)})}},{key:"DATABASE_URL",get:function(){return"http://localhost:".concat(1337)}}]),o}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRiaGVscGVyLmpzIl0sIm5hbWVzIjpbIkRCSGVscGVyIiwiY2FsbGJhY2siLCJmZXRjaCIsImNvbmNhdCIsIkRBVEFCQVNFX1VSTCIsInRoZW4iLCJyZXMiLCJzdGF0dXMiLCJqc29uIiwicmVzdGF1cmFudHMiLCJlcnJvciIsInhociIsImNhdGNoIiwicmV2aWV3cyIsImlkIiwiZmV0Y2hSZXN0YXVyYW50cyIsInJlc3RhdXJhbnQiLCJmaW5kIiwiciIsImN1aXNpbmUiLCJyZXN1bHRzIiwiZmlsdGVyIiwiY3Vpc2luZV90eXBlIiwibmVpZ2hib3Job29kIiwibmVpZ2hib3Job29kcyIsIm1hcCIsInYiLCJpIiwidW5pcXVlTmVpZ2hib3Job29kcyIsImluZGV4T2YiLCJjdWlzaW5lcyIsInVuaXF1ZUN1aXNpbmVzIiwiaW1hZ2VBbHQiLCJtYXJrZXIiLCJMIiwibGF0bG5nIiwibGF0IiwibG5nIiwidGl0bGUiLCJuYW1lIiwiYWx0IiwidXJsIiwidXJsRm9yUmVzdGF1cmFudCIsImFkZFRvIiwibmV3TWFwIiwiYWRkIiwiSGVhZGVycyIsImFwcGVuZCIsInRoaXMiLCJzZW5kUmVxdWVzdCIsIm1ldGhvZCIsIm1vZGUiLCJjYWNoZSIsImNyZWRlbnRpYWxzIiwicmV2aWV3IiwicmV2aWV3SGVhZGVycyIsIm9wdGlvbnMiLCJoZWFkZXJzIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJyZXNwb25zZSIsIm9rIiwiRXJyb3IiLCJzdGF0dXNUZXh0IiwiZGF0YSIsImNvbnNvbGUiLCJsb2ciXSwibWFwcGluZ3MiOiJ1WkFHTUEsNEhBYW9CQyxHQUN0QkMsTUFBSyxHQUFBQyxPQUFJSCxFQUFTSSxhQUFiLGlCQUF5Q0MsS0FBSyxTQUFBQyxHQUNqRCxHQUFtQixNQUFmQSxFQUFJQyxPQUVORCxFQUFJRSxPQUFPSCxLQUFLLFNBQUNJLEdBQ2ZSLEVBQVMsS0FBTVEsU0FFWixDQUVMLElBQU1DLEVBQUssc0NBQUFQLE9BQXlDUSxJQUFJSixRQUN4RE4sRUFB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LEVBQVMsSUFBSUMsRUFBRUQsT0FDbkIsQ0FBQ2pCLEVBQVdtQixPQUFPQyxJQUFLcEIsRUFBV21CLE9BQU9FLEtBQzFDLENBQ0VDLE1BQU90QixFQUFXdUIsS0FDbEJDLElBQUt4QixFQUFXdUIsS0FDaEJFLElBQUt6QyxFQUFTMEMsaUJBQWlCMUIsS0FJbkMsT0FEQWlCLEVBQU9VLE1BQU1DLFFBQ05YLHdDQUdZbkIsRUFBSStCLElBQ04sSUFBSUMsU0FDVkMsT0FBTyxlQUFnQixvQkFFbEMsSUFBSU4sRUFBRyxxQ0FBQXRDLE9BQXdDVyxFQUF4QyxrQkFBQVgsT0FBMkQwQyxHQU9sRUcsS0FBS0MsWUFBWVIsRUFOSCxDQUNaUyxPQUFRLE1BQ1JDLEtBQU0sT0FDTkMsTUFBTyxXQUNQQyxZQUFhLG1EQUtDQyxHQUNoQixJQUFJQyxFQUFnQixJQUFJVCxRQUN4QlMsRUFBY1IsT0FBTyxlQUFnQixvQkFFckMsSUFBSVMsRUFBVSxDQUNaTixPQUFRLE9BQ1JDLEtBQU0sT0FDTkMsTUFBTyxXQUNQQyxZQUFhLGNBQ2JJLFFBQVNGLEVBQ1RHLEtBQU1DLEtBQUtDLFVBQVVOLElBR3ZCTixLQUFLQyxZQUFZLGlDQUFrQ08sdUNBR2xDZixFQUFLZSxHQUN0QnRELE1BQU11QyxFQUFLZSxHQUNSbkQsS0FBSyxTQUFBd0QsR0FDSixJQUFLQSxFQUFTQyxHQUNaLE1BQU1DLE1BQU1GLEVBQVNHLFlBRXZCLE9BQU9ILEVBQVNyRCxTQUVqQkgsS0FBSyxTQUFDNEQsR0FDTEMsUUFBUUMsSUFBSSxPQUFRRixLQUVyQnJELE1BQU0sU0FBQUYsR0FBSyxPQUFJd0QsUUFBUUMsSUFBSSxTQUFVekQsMENBM1F4QyxNQUFBLG9CQUFBUCxPQURhIiwiZmlsZSI6ImRiaGVscGVyLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBDb21tb24gZGF0YWJhc2UgaGVscGVyIGZ1bmN0aW9ucy5cclxuICovXHJcbmNsYXNzIERCSGVscGVyIHtcclxuICAvKipcclxuICAgKiBEYXRhYmFzZSBVUkwuXHJcbiAgICogQ2hhbmdlIHRoaXMgdG8gcmVzdGF1cmFudHMuanNvbiBmaWxlIGxvY2F0aW9uIG9uIHlvdXIgc2VydmVyLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBnZXQgREFUQUJBU0VfVVJMKCkge1xyXG4gICAgY29uc3QgcG9ydCA9IDEzMzcgLy8gQ2hhbmdlIHRoaXMgdG8geW91ciBzZXJ2ZXIgcG9ydFxyXG4gICAgcmV0dXJuIGBodHRwOi8vbG9jYWxob3N0OiR7cG9ydH1gXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhbGwgcmVzdGF1cmFudHMuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudHMoY2FsbGJhY2spIHtcclxuICAgIGZldGNoKGAke0RCSGVscGVyLkRBVEFCQVNFX1VSTH0vcmVzdGF1cmFudHNgKS50aGVuKHJlcyA9PiB7XHJcbiAgICAgIGlmIChyZXMuc3RhdHVzID09PSAyMDApIHtcclxuICAgICAgICAvLyBHb3QgYSBzdWNjZXNzIHJlc3BvbnNlIGZyb20gc2VydmVyIVxyXG4gICAgICAgIHJlcy5qc29uKCkudGhlbigocmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnRzKVxyXG4gICAgICAgIH0pXHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gT29wcyEuIEdvdCBhbiBlcnJvciBmcm9tIHNlcnZlci5cclxuICAgICAgICBjb25zdCBlcnJvciA9IGBSZXF1ZXN0IGZhaWxlZC4gUmV0dXJuZWQgc3RhdHVzIG9mICR7eGhyLnN0YXR1c31gXHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpXHJcbiAgICAgIH1cclxuICAgIH0pLmNhdGNoKGVycm9yID0+IHtcclxuICAgICAgLy8gY29uc29sZS5sb2coZXJyb3IpXHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYWxsIHJldmlld3MuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmV2aWV3cyhjYWxsYmFjaykge1xyXG4gICAgZmV0Y2goYCR7REJIZWxwZXIuREFUQUJBU0VfVVJMfS9yZXZpZXdzYCkudGhlbihyZXMgPT4ge1xyXG4gICAgICBpZiAocmVzLnN0YXR1cyA9PT0gMjAwKSB7XHJcbiAgICAgICAgLy8gR290IGEgc3VjY2VzcyByZXNwb25zZSBmcm9tIHNlcnZlciFcclxuXHJcbiAgICAgICAgcmVzLmpzb24oKS50aGVuKChyZXZpZXdzKSA9PiB7XHJcbiAgICAgICAgICBjYWxsYmFjayhudWxsLCByZXZpZXdzKVxyXG4gICAgICAgIH0pXHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gT29wcyEuIEdvdCBhbiBlcnJvciBmcm9tIHNlcnZlci5cclxuICAgICAgICBjb25zdCBlcnJvciA9IGBSZXF1ZXN0IGZhaWxlZC4gUmV0dXJuZWQgc3RhdHVzIG9mICR7eGhyLnN0YXR1c31gXHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpXHJcbiAgICAgIH1cclxuICAgIH0pLmNhdGNoKGVycm9yID0+IHtcclxuICAgICAgLy8gY29uc29sZS5sb2coZXJyb3IpXHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYSByZXN0YXVyYW50IGJ5IGl0cyBJRC5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlJZChpZCwgY2FsbGJhY2spIHtcclxuICAgIC8vIGZldGNoIGFsbCByZXN0YXVyYW50cyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbClcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zdCByZXN0YXVyYW50ID0gcmVzdGF1cmFudHMuZmluZChyID0+IHIuaWQgPT0gaWQpXHJcbiAgICAgICAgaWYgKHJlc3RhdXJhbnQpIHtcclxuICAgICAgICAgIC8vIEdvdCB0aGUgcmVzdGF1cmFudFxyXG4gICAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudClcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgLy8gUmVzdGF1cmFudCBkb2VzIG5vdCBleGlzdCBpbiB0aGUgZGF0YWJhc2VcclxuICAgICAgICAgIGNhbGxiYWNrKCdSZXN0YXVyYW50IGRvZXMgbm90IGV4aXN0JywgbnVsbClcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhbGwgcmV2aWV3IGJ5IHJlc3RhdXJhbnQgSUQuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmV2aWV3c0J5UmVzdGF1cmFudElkKGlkLCBjYWxsYmFjaykge1xyXG4gICAgLy8gZmV0Y2ggYWxsIHJldmlld3Mgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICBmZXRjaChgJHtEQkhlbHBlci5EQVRBQkFTRV9VUkx9L3Jldmlld3MvP3Jlc3RhdXJhbnRfaWQ9JHtpZH1gKVxyXG4gICAgICAudGhlbihyZXMgPT4ge1xyXG4gICAgICAgIGlmIChyZXMuc3RhdHVzID09PSAyMDApIHtcclxuICAgICAgICAgIC8vIEdvdCBhIHN1Y2Nlc3MgcmVzcG9uc2UgZnJvbSBzZXJ2ZXIhXHJcbiAgICAgICAgICByZXMuanNvbigpLnRoZW4oKHJldmlld3MpID0+IHtcclxuICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgcmV2aWV3cylcclxuICAgICAgICAgIH0pXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIC8vIE9vcHMhLiBHb3QgYW4gZXJyb3IgZnJvbSBzZXJ2ZXIuXHJcbiAgICAgICAgICBjb25zdCBlcnJvciA9IGBSZXF1ZXN0IGZhaWxlZC4gUmV0dXJuZWQgc3RhdHVzIG9mICR7eGhyLnN0YXR1c31gXHJcbiAgICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbClcclxuICAgICAgICB9XHJcbiAgICAgIH0pLmNhdGNoKGVycm9yID0+IHtcclxuICAgICAgICAvLyBjb25zb2xlLmxvZyhlcnJvcilcclxuICAgICAgfSlcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSB0eXBlIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmUoY3Vpc2luZSwgY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50cyAgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmdcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbClcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBGaWx0ZXIgcmVzdGF1cmFudHMgdG8gaGF2ZSBvbmx5IGdpdmVuIGN1aXNpbmUgdHlwZVxyXG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSByZXN0YXVyYW50cy5maWx0ZXIociA9PiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lKVxyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpXHJcbiAgICAgIH1cclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIG5laWdoYm9yaG9vZCB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlOZWlnaGJvcmhvb2QobmVpZ2hib3Job29kLCBjYWxsYmFjaykge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpXHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gRmlsdGVyIHJlc3RhdXJhbnRzIHRvIGhhdmUgb25seSBnaXZlbiBuZWlnaGJvcmhvb2RcclxuICAgICAgICBjb25zdCByZXN1bHRzID0gcmVzdGF1cmFudHMuZmlsdGVyKHIgPT4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kKVxyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpXHJcbiAgICAgIH1cclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgYW5kIGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QoXHJcbiAgICBjdWlzaW5lLFxyXG4gICAgbmVpZ2hib3Job29kLFxyXG4gICAgY2FsbGJhY2tcclxuICApIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGxldCByZXN1bHRzID0gcmVzdGF1cmFudHNcclxuICAgICAgICBpZiAoY3Vpc2luZSAhPSAnYWxsJykge1xyXG4gICAgICAgICAgLy8gZmlsdGVyIGJ5IGN1aXNpbmVcclxuICAgICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIuY3Vpc2luZV90eXBlID09IGN1aXNpbmUpXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChuZWlnaGJvcmhvb2QgIT0gJ2FsbCcpIHtcclxuICAgICAgICAgIC8vIGZpbHRlciBieSBuZWlnaGJvcmhvb2RcclxuICAgICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZClcclxuICAgICAgICB9XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cylcclxuICAgICAgfVxyXG4gICAgfSlcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGFsbCBuZWlnaGJvcmhvb2RzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaE5laWdoYm9yaG9vZHMoY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIEdldCBhbGwgbmVpZ2hib3Job29kcyBmcm9tIGFsbCByZXN0YXVyYW50c1xyXG4gICAgICAgIGNvbnN0IG5laWdoYm9yaG9vZHMgPSByZXN0YXVyYW50cy5tYXAoXHJcbiAgICAgICAgICAodiwgaSkgPT4gcmVzdGF1cmFudHNbaV0ubmVpZ2hib3Job29kXHJcbiAgICAgICAgKVxyXG4gICAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gbmVpZ2hib3Job29kc1xyXG4gICAgICAgIGNvbnN0IHVuaXF1ZU5laWdoYm9yaG9vZHMgPSBuZWlnaGJvcmhvb2RzLmZpbHRlcihcclxuICAgICAgICAgICh2LCBpKSA9PiBuZWlnaGJvcmhvb2RzLmluZGV4T2YodikgPT0gaVxyXG4gICAgICAgIClcclxuICAgICAgICBjYWxsYmFjayhudWxsLCB1bmlxdWVOZWlnaGJvcmhvb2RzKVxyXG4gICAgICB9XHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYWxsIGN1aXNpbmVzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaEN1aXNpbmVzKGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbClcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBHZXQgYWxsIGN1aXNpbmVzIGZyb20gYWxsIHJlc3RhdXJhbnRzXHJcbiAgICAgICAgY29uc3QgY3Vpc2luZXMgPSByZXN0YXVyYW50cy5tYXAoKHYsIGkpID0+IHJlc3RhdXJhbnRzW2ldLmN1aXNpbmVfdHlwZSlcclxuICAgICAgICAvLyBSZW1vdmUgZHVwbGljYXRlcyBmcm9tIGN1aXNpbmVzXHJcbiAgICAgICAgY29uc3QgdW5pcXVlQ3Vpc2luZXMgPSBjdWlzaW5lcy5maWx0ZXIoXHJcbiAgICAgICAgICAodiwgaSkgPT4gY3Vpc2luZXMuaW5kZXhPZih2KSA9PSBpXHJcbiAgICAgICAgKVxyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHVuaXF1ZUN1aXNpbmVzKVxyXG4gICAgICB9XHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzdGF1cmFudCBwYWdlIFVSTC5cclxuICAgKi9cclxuICBzdGF0aWMgdXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XHJcbiAgICByZXR1cm4gYC4vcmVzdGF1cmFudC5odG1sP2lkPSR7cmVzdGF1cmFudC5pZH1gXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXN0YXVyYW50IGltYWdlIFVSTC5cclxuICAgKi9cclxuICBzdGF0aWMgaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcclxuICAgIHJldHVybiBgcHVibGljL2ltZy8ke3Jlc3RhdXJhbnQuaWR9LmpwZ2BcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlc3RhdXJhbnQgaW1hZ2UgYWx0IHRhZ1xyXG4gICAqL1xyXG4gIHN0YXRpYyBpbWFnZUFsdGZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xyXG4gICAgcmV0dXJuIHJlc3RhdXJhbnQuaW1hZ2VBbHRcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIE1hcCBtYXJrZXIgZm9yIGEgcmVzdGF1cmFudC5cclxuICAgKi9cclxuICBzdGF0aWMgbWFwTWFya2VyRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCBtYXApIHtcclxuICAgIC8vIGh0dHBzOi8vbGVhZmxldGpzLmNvbS9yZWZlcmVuY2UtMS4zLjAuaHRtbCNtYXJrZXJcclxuICAgIGNvbnN0IG1hcmtlciA9IG5ldyBMLm1hcmtlcihcclxuICAgICAgW3Jlc3RhdXJhbnQubGF0bG5nLmxhdCwgcmVzdGF1cmFudC5sYXRsbmcubG5nXSxcclxuICAgICAge1xyXG4gICAgICAgIHRpdGxlOiByZXN0YXVyYW50Lm5hbWUsXHJcbiAgICAgICAgYWx0OiByZXN0YXVyYW50Lm5hbWUsXHJcbiAgICAgICAgdXJsOiBEQkhlbHBlci51cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpXHJcbiAgICAgIH1cclxuICAgIClcclxuICAgIG1hcmtlci5hZGRUbyhuZXdNYXApXHJcbiAgICByZXR1cm4gbWFya2VyXHJcbiAgfVxyXG5cclxuICBzdGF0aWMgc2VuZFRvZ2dsZUZhdihpZCwgYWRkKSB7XHJcbiAgICBsZXQgZmF2SGVhZGVycyA9IG5ldyBIZWFkZXJzKClcclxuICAgIGZhdkhlYWRlcnMuYXBwZW5kKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpXHJcblxyXG4gICAgbGV0IHVybCA9IGBodHRwOi8vbG9jYWxob3N0OjEzMzcvcmVzdGF1cmFudHMvJHtpZH0vP2lzX2Zhdm9yaXRlPSR7YWRkfWBcclxuICAgIGxldCBvcHRpb25zID0ge1xyXG4gICAgICBtZXRob2Q6ICdQVVQnLFxyXG4gICAgICBtb2RlOiAnY29ycycsXHJcbiAgICAgIGNhY2hlOiAnbm8tY2FjaGUnLFxyXG4gICAgICBjcmVkZW50aWFsczogJ3NhbWUtb3JpZ2luJyxcclxuICAgIH1cclxuICAgIHRoaXMuc2VuZFJlcXVlc3QodXJsLCBvcHRpb25zKVxyXG4gIH1cclxuXHJcbiAgc3RhdGljIGFkZFJldmlld3MocmV2aWV3KSB7XHJcbiAgICBsZXQgcmV2aWV3SGVhZGVycyA9IG5ldyBIZWFkZXJzKClcclxuICAgIHJldmlld0hlYWRlcnMuYXBwZW5kKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpXHJcblxyXG4gICAgbGV0IG9wdGlvbnMgPSB7XHJcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICBtb2RlOiAnY29ycycsXHJcbiAgICAgIGNhY2hlOiAnbm8tY2FjaGUnLFxyXG4gICAgICBjcmVkZW50aWFsczogJ3NhbWUtb3JpZ2luJyxcclxuICAgICAgaGVhZGVyczogcmV2aWV3SGVhZGVycyxcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkocmV2aWV3KVxyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuc2VuZFJlcXVlc3QoJ2h0dHA6Ly9sb2NhbGhvc3Q6MTMzNy9yZXZpZXdzLycsIG9wdGlvbnMpXHJcbiAgfVxyXG5cclxuICBzdGF0aWMgc2VuZFJlcXVlc3QodXJsLCBvcHRpb25zKSB7XHJcbiAgICBmZXRjaCh1cmwsIG9wdGlvbnMpXHJcbiAgICAgIC50aGVuKHJlc3BvbnNlID0+IHtcclxuICAgICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XHJcbiAgICAgICAgICB0aHJvdyBFcnJvcihyZXNwb25zZS5zdGF0dXNUZXh0KVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpXHJcbiAgICAgIH0pXHJcbiAgICAgIC50aGVuKChkYXRhKSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ1NlbnQnLCBkYXRhKVxyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goZXJyb3IgPT4gY29uc29sZS5sb2coJ0ZhaWxlZCcsIGVycm9yKSlcclxuICB9XHJcbn1cclxuIl19
