"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,n,t){return n&&_defineProperties(e.prototype,n),t&&_defineProperties(e,t),e}var DBHelper=function(){function o(){_classCallCheck(this,o)}return _createClass(o,null,[{key:"fetchRestaurants",value:function(t){fetch("".concat(o.DATABASE_URL,"/restaurants")).then(function(e){if(200===e.status)e.json().then(function(e){t(null,e)});else{var n="Request failed. Returned status of ".concat(xhr.status);t(n,null)}}).catch(function(e){})}},{key:"fetchReviews",value:function(t){fetch("".concat(o.DATABASE_URL,"/reviews")).then(function(e){if(200===e.status)e.json().then(function(e){t(null,e)});else{var n="Request failed. Returned status of ".concat(xhr.status);t(n,null)}}).catch(function(e){})}},{key:"fetchRestaurantById",value:function(a,u){o.fetchRestaurants(function(e,n){if(e)u(e,null);else{var t=n.find(function(e){return e.id==a});t?u(null,t):u("Restaurant does not exist",null)}})}},{key:"fetchReviewsByRestaurantId",value:function(e,t){fetch("".concat(o.DATABASE_URL,"/reviews/?restaurant_id=").concat(e)).then(function(e){if(200===e.status)e.json().then(function(e){t(null,e)});else{var n="Request failed. Returned status of ".concat(xhr.status);t(n,null)}}).catch(function(e){})}},{key:"fetchRestaurantByCuisine",value:function(a,u){o.fetchRestaurants(function(e,n){if(e)u(e,null);else{var t=n.filter(function(e){return e.cuisine_type==a});u(null,t)}})}},{key:"fetchRestaurantByNeighborhood",value:function(a,u){o.fetchRestaurants(function(e,n){if(e)u(e,null);else{var t=n.filter(function(e){return e.neighborhood==a});u(null,t)}})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(a,u,r){o.fetchRestaurants(function(e,n){if(e)r(e,null);else{var t=n;"all"!=a&&(t=t.filter(function(e){return e.cuisine_type==a})),"all"!=u&&(t=t.filter(function(e){return e.neighborhood==u})),r(null,t)}})}},{key:"fetchNeighborhoods",value:function(u){o.fetchRestaurants(function(e,t){if(e)u(e,null);else{var a=t.map(function(e,n){return t[n].neighborhood}),n=a.filter(function(e,n){return a.indexOf(e)==n});u(null,n)}})}},{key:"fetchCuisines",value:function(u){o.fetchRestaurants(function(e,t){if(e)u(e,null);else{var a=t.map(function(e,n){return t[n].cuisine_type}),n=a.filter(function(e,n){return a.indexOf(e)==n});u(null,n)}})}},{key:"urlForRestaurant",value:function(e){return"./restaurant.html?id=".concat(e.id)}},{key:"imageUrlForRestaurant",value:function(e){return"public/img/".concat(e.id,".jpg")}},{key:"imageAltforRestaurant",value:function(e){return e.imageAlt}},{key:"mapMarkerForRestaurant",value:function(e,n){var t=new L.marker([e.latlng.lat,e.latlng.lng],{title:e.name,alt:e.name,url:o.urlForRestaurant(e)});return t.addTo(newMap),t}},{key:"sendToggleFav",value:function(e,n){(new Headers).append("Content-Type","application/json"),console.log(n);var t="http://localhost:1337/restaurants/".concat(e,"/?is_favorite=").concat(n);this.sendRequest(t,{method:"PUT",mode:"cors",cache:"no-cache",credentials:"same-origin"})}},{key:"addReviews",value:function(e){var n=new Headers;n.append("Content-Type","application/json");var t={method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:n,body:JSON.stringify(e)};this.sendRequest("http://localhost:1337/reviews/",t)}},{key:"sendRequest",value:function(e,n){fetch(e,n).then(function(e){if(!e.ok)throw Error(e.statusText);return e.json()}).then(function(e){console.log("Sent",e)}).catch(function(e){return console.log("Failed",e)})}},{key:"DATABASE_URL",get:function(){return"http://localhost:".concat(1337)}}]),o}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRiaGVscGVyLmpzIl0sIm5hbWVzIjpbIkRCSGVscGVyIiwiY2FsbGJhY2siLCJmZXRjaCIsImNvbmNhdCIsIkRBVEFCQVNFX1VSTCIsInRoZW4iLCJyZXMiLCJzdGF0dXMiLCJqc29uIiwicmVzdGF1cmFudHMiLCJlcnJvciIsInhociIsImNhdGNoIiwicmV2aWV3cyIsImlkIiwiZmV0Y2hSZXN0YXVyYW50cyIsInJlc3RhdXJhbnQiLCJmaW5kIiwiciIsImN1aXNpbmUiLCJyZXN1bHRzIiwiZmlsdGVyIiwiY3Vpc2luZV90eXBlIiwibmVpZ2hib3Job29kIiwibmVpZ2hib3Job29kcyIsIm1hcCIsInYiLCJpIiwidW5pcXVlTmVpZ2hib3Job29kcyIsImluZGV4T2YiLCJjdWlzaW5lcyIsInVuaXF1ZUN1aXNpbmVzIiwiaW1hZ2VBbHQiLCJtYXJrZXIiLCJMIiwibGF0bG5nIiwibGF0IiwibG5nIiwidGl0bGUiLCJuYW1lIiwiYWx0IiwidXJsIiwidXJsRm9yUmVzdGF1cmFudCIsImFkZFRvIiwibmV3TWFwIiwiYWRkIiwiSGVhZGVycyIsImFwcGVuZCIsImNvbnNvbGUiLCJsb2ciLCJ0aGlzIiwic2VuZFJlcXVlc3QiLCJtZXRob2QiLCJtb2RlIiwiY2FjaGUiLCJjcmVkZW50aWFscyIsInJldmlldyIsInJldmlld0hlYWRlcnMiLCJvcHRpb25zIiwiaGVhZGVycyIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwicmVzcG9uc2UiLCJvayIsIkVycm9yIiwic3RhdHVzVGV4dCIsImRhdGEiXSwibWFwcGluZ3MiOiJ1WkFHTUEsNEhBYW9CQyxHQUN0QkMsTUFBSyxHQUFBQyxPQUFJSCxFQUFTSSxhQUFiLGlCQUF5Q0MsS0FBSyxTQUFBQyxHQUNqRCxHQUFtQixNQUFmQSxFQUFJQyxPQUVORCxFQUFJRSxPQUFPSCxLQUFLLFNBQUNJLEdBQ2ZSLEVBQVMsS0FBTVEsU0FFWixDQUVMLElBQU1DLEVBQUssc0NBQUFQLE9BQXlDUSxJQUFJSixRQUN4RE4sRUFB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LEVBQVMsSUFBSUMsRUFBRUQsT0FDbkIsQ0FBQ2pCLEVBQVdtQixPQUFPQyxJQUFLcEIsRUFBV21CLE9BQU9FLEtBQzFDLENBQ0VDLE1BQU90QixFQUFXdUIsS0FDbEJDLElBQUt4QixFQUFXdUIsS0FDaEJFLElBQUt6QyxFQUFTMEMsaUJBQWlCMUIsS0FJbkMsT0FEQWlCLEVBQU9VLE1BQU1DLFFBQ05YLHdDQUdZbkIsRUFBSStCLElBQ04sSUFBSUMsU0FDVkMsT0FBTyxlQUFnQixvQkFDbENDLFFBQVFDLElBQUlKLEdBRVosSUFBSUosRUFBRyxxQ0FBQXRDLE9BQXdDVyxFQUF4QyxrQkFBQVgsT0FBMkQwQyxHQU9sRUssS0FBS0MsWUFBWVYsRUFOSCxDQUNaVyxPQUFRLE1BQ1JDLEtBQU0sT0FDTkMsTUFBTyxXQUNQQyxZQUFhLG1EQUtDQyxHQUNoQixJQUFJQyxFQUFnQixJQUFJWCxRQUN4QlcsRUFBY1YsT0FBTyxlQUFnQixvQkFFckMsSUFBSVcsRUFBVSxDQUNaTixPQUFRLE9BQ1JDLEtBQU0sT0FDTkMsTUFBTyxXQUNQQyxZQUFhLGNBQ2JJLFFBQVNGLEVBQ1RHLEtBQU1DLEtBQUtDLFVBQVVOLElBR3ZCTixLQUFLQyxZQUFZLGlDQUFrQ08sdUNBR2xDakIsRUFBS2lCLEdBQ3RCeEQsTUFBTXVDLEVBQUtpQixHQUNSckQsS0FBSyxTQUFBMEQsR0FDSixJQUFLQSxFQUFTQyxHQUNaLE1BQU1DLE1BQU1GLEVBQVNHLFlBRXZCLE9BQU9ILEVBQVN2RCxTQUVqQkgsS0FBSyxTQUFDOEQsR0FDTG5CLFFBQVFDLElBQUksT0FBUWtCLEtBRXJCdkQsTUFBTSxTQUFBRixHQUFLLE9BQUlzQyxRQUFRQyxJQUFJLFNBQVV2QywwQ0E1UXhDLE1BQUEsb0JBQUFQLE9BRGEiLCJmaWxlIjoiZGJoZWxwZXIubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIENvbW1vbiBkYXRhYmFzZSBoZWxwZXIgZnVuY3Rpb25zLlxyXG4gKi9cclxuY2xhc3MgREJIZWxwZXIge1xyXG4gIC8qKlxyXG4gICAqIERhdGFiYXNlIFVSTC5cclxuICAgKiBDaGFuZ2UgdGhpcyB0byByZXN0YXVyYW50cy5qc29uIGZpbGUgbG9jYXRpb24gb24geW91ciBzZXJ2ZXIuXHJcbiAgICovXHJcbiAgc3RhdGljIGdldCBEQVRBQkFTRV9VUkwoKSB7XHJcbiAgICBjb25zdCBwb3J0ID0gMTMzNyAvLyBDaGFuZ2UgdGhpcyB0byB5b3VyIHNlcnZlciBwb3J0XHJcbiAgICByZXR1cm4gYGh0dHA6Ly9sb2NhbGhvc3Q6JHtwb3J0fWBcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGFsbCByZXN0YXVyYW50cy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50cyhjYWxsYmFjaykge1xyXG4gICAgZmV0Y2goYCR7REJIZWxwZXIuREFUQUJBU0VfVVJMfS9yZXN0YXVyYW50c2ApLnRoZW4ocmVzID0+IHtcclxuICAgICAgaWYgKHJlcy5zdGF0dXMgPT09IDIwMCkge1xyXG4gICAgICAgIC8vIEdvdCBhIHN1Y2Nlc3MgcmVzcG9uc2UgZnJvbSBzZXJ2ZXIhXHJcbiAgICAgICAgcmVzLmpzb24oKS50aGVuKChyZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudHMpXHJcbiAgICAgICAgfSlcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBPb3BzIS4gR290IGFuIGVycm9yIGZyb20gc2VydmVyLlxyXG4gICAgICAgIGNvbnN0IGVycm9yID0gYFJlcXVlc3QgZmFpbGVkLiBSZXR1cm5lZCBzdGF0dXMgb2YgJHt4aHIuc3RhdHVzfWBcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbClcclxuICAgICAgfVxyXG4gICAgfSkuY2F0Y2goZXJyb3IgPT4ge1xyXG4gICAgICAvLyBjb25zb2xlLmxvZyhlcnJvcilcclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhbGwgcmV2aWV3cy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXZpZXdzKGNhbGxiYWNrKSB7XHJcbiAgICBmZXRjaChgJHtEQkhlbHBlci5EQVRBQkFTRV9VUkx9L3Jldmlld3NgKS50aGVuKHJlcyA9PiB7XHJcbiAgICAgIGlmIChyZXMuc3RhdHVzID09PSAyMDApIHtcclxuICAgICAgICAvLyBHb3QgYSBzdWNjZXNzIHJlc3BvbnNlIGZyb20gc2VydmVyIVxyXG5cclxuICAgICAgICByZXMuanNvbigpLnRoZW4oKHJldmlld3MpID0+IHtcclxuICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHJldmlld3MpXHJcbiAgICAgICAgfSlcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBPb3BzIS4gR290IGFuIGVycm9yIGZyb20gc2VydmVyLlxyXG4gICAgICAgIGNvbnN0IGVycm9yID0gYFJlcXVlc3QgZmFpbGVkLiBSZXR1cm5lZCBzdGF0dXMgb2YgJHt4aHIuc3RhdHVzfWBcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbClcclxuICAgICAgfVxyXG4gICAgfSkuY2F0Y2goZXJyb3IgPT4ge1xyXG4gICAgICAvLyBjb25zb2xlLmxvZyhlcnJvcilcclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhIHJlc3RhdXJhbnQgYnkgaXRzIElELlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUlkKGlkLCBjYWxsYmFjaykge1xyXG4gICAgLy8gZmV0Y2ggYWxsIHJlc3RhdXJhbnRzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnN0IHJlc3RhdXJhbnQgPSByZXN0YXVyYW50cy5maW5kKHIgPT4gci5pZCA9PSBpZClcclxuICAgICAgICBpZiAocmVzdGF1cmFudCkge1xyXG4gICAgICAgICAgLy8gR290IHRoZSByZXN0YXVyYW50XHJcbiAgICAgICAgICBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50KVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAvLyBSZXN0YXVyYW50IGRvZXMgbm90IGV4aXN0IGluIHRoZSBkYXRhYmFzZVxyXG4gICAgICAgICAgY2FsbGJhY2soJ1Jlc3RhdXJhbnQgZG9lcyBub3QgZXhpc3QnLCBudWxsKVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSlcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGFsbCByZXZpZXcgYnkgcmVzdGF1cmFudCBJRC5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXZpZXdzQnlSZXN0YXVyYW50SWQoaWQsIGNhbGxiYWNrKSB7XHJcbiAgICAvLyBmZXRjaCBhbGwgcmV2aWV3cyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgIGZldGNoKGAke0RCSGVscGVyLkRBVEFCQVNFX1VSTH0vcmV2aWV3cy8/cmVzdGF1cmFudF9pZD0ke2lkfWApXHJcbiAgICAgIC50aGVuKHJlcyA9PiB7XHJcbiAgICAgICAgaWYgKHJlcy5zdGF0dXMgPT09IDIwMCkge1xyXG4gICAgICAgICAgLy8gR290IGEgc3VjY2VzcyByZXNwb25zZSBmcm9tIHNlcnZlciFcclxuICAgICAgICAgIHJlcy5qc29uKCkudGhlbigocmV2aWV3cykgPT4ge1xyXG4gICAgICAgICAgICBjYWxsYmFjayhudWxsLCByZXZpZXdzKVxyXG4gICAgICAgICAgfSlcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgLy8gT29wcyEuIEdvdCBhbiBlcnJvciBmcm9tIHNlcnZlci5cclxuICAgICAgICAgIGNvbnN0IGVycm9yID0gYFJlcXVlc3QgZmFpbGVkLiBSZXR1cm5lZCBzdGF0dXMgb2YgJHt4aHIuc3RhdHVzfWBcclxuICAgICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKVxyXG4gICAgICAgIH1cclxuICAgICAgfSkuY2F0Y2goZXJyb3IgPT4ge1xyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKGVycm9yKVxyXG4gICAgICB9KVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBjdWlzaW5lIHR5cGUgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZShjdWlzaW5lLCBjYWxsYmFjaykge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzICB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZ1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIEZpbHRlciByZXN0YXVyYW50cyB0byBoYXZlIG9ubHkgZ2l2ZW4gY3Vpc2luZSB0eXBlXHJcbiAgICAgICAgY29uc3QgcmVzdWx0cyA9IHJlc3RhdXJhbnRzLmZpbHRlcihyID0+IHIuY3Vpc2luZV90eXBlID09IGN1aXNpbmUpXHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cylcclxuICAgICAgfVxyXG4gICAgfSlcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeU5laWdoYm9yaG9vZChuZWlnaGJvcmhvb2QsIGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbClcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBGaWx0ZXIgcmVzdGF1cmFudHMgdG8gaGF2ZSBvbmx5IGdpdmVuIG5laWdoYm9yaG9vZFxyXG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSByZXN0YXVyYW50cy5maWx0ZXIociA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpXHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cylcclxuICAgICAgfVxyXG4gICAgfSlcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSBhbmQgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChcclxuICAgIGN1aXNpbmUsXHJcbiAgICBuZWlnaGJvcmhvb2QsXHJcbiAgICBjYWxsYmFja1xyXG4gICkge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpXHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgbGV0IHJlc3VsdHMgPSByZXN0YXVyYW50c1xyXG4gICAgICAgIGlmIChjdWlzaW5lICE9ICdhbGwnKSB7XHJcbiAgICAgICAgICAvLyBmaWx0ZXIgYnkgY3Vpc2luZVxyXG4gICAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZSlcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG5laWdoYm9yaG9vZCAhPSAnYWxsJykge1xyXG4gICAgICAgICAgLy8gZmlsdGVyIGJ5IG5laWdoYm9yaG9vZFxyXG4gICAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kKVxyXG4gICAgICAgIH1cclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKVxyXG4gICAgICB9XHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYWxsIG5laWdoYm9yaG9vZHMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoTmVpZ2hib3Job29kcyhjYWxsYmFjaykge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpXHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gR2V0IGFsbCBuZWlnaGJvcmhvb2RzIGZyb20gYWxsIHJlc3RhdXJhbnRzXHJcbiAgICAgICAgY29uc3QgbmVpZ2hib3Job29kcyA9IHJlc3RhdXJhbnRzLm1hcChcclxuICAgICAgICAgICh2LCBpKSA9PiByZXN0YXVyYW50c1tpXS5uZWlnaGJvcmhvb2RcclxuICAgICAgICApXHJcbiAgICAgICAgLy8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBuZWlnaGJvcmhvb2RzXHJcbiAgICAgICAgY29uc3QgdW5pcXVlTmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHMuZmlsdGVyKFxyXG4gICAgICAgICAgKHYsIGkpID0+IG5laWdoYm9yaG9vZHMuaW5kZXhPZih2KSA9PSBpXHJcbiAgICAgICAgKVxyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHVuaXF1ZU5laWdoYm9yaG9vZHMpXHJcbiAgICAgIH1cclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhbGwgY3Vpc2luZXMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoQ3Vpc2luZXMoY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIEdldCBhbGwgY3Vpc2luZXMgZnJvbSBhbGwgcmVzdGF1cmFudHNcclxuICAgICAgICBjb25zdCBjdWlzaW5lcyA9IHJlc3RhdXJhbnRzLm1hcCgodiwgaSkgPT4gcmVzdGF1cmFudHNbaV0uY3Vpc2luZV90eXBlKVxyXG4gICAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gY3Vpc2luZXNcclxuICAgICAgICBjb25zdCB1bmlxdWVDdWlzaW5lcyA9IGN1aXNpbmVzLmZpbHRlcihcclxuICAgICAgICAgICh2LCBpKSA9PiBjdWlzaW5lcy5pbmRleE9mKHYpID09IGlcclxuICAgICAgICApXHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgdW5pcXVlQ3Vpc2luZXMpXHJcbiAgICAgIH1cclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXN0YXVyYW50IHBhZ2UgVVJMLlxyXG4gICAqL1xyXG4gIHN0YXRpYyB1cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcclxuICAgIHJldHVybiBgLi9yZXN0YXVyYW50Lmh0bWw/aWQ9JHtyZXN0YXVyYW50LmlkfWBcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlc3RhdXJhbnQgaW1hZ2UgVVJMLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBpbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xyXG4gICAgcmV0dXJuIGBwdWJsaWMvaW1nLyR7cmVzdGF1cmFudC5pZH0uanBnYFxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzdGF1cmFudCBpbWFnZSBhbHQgdGFnXHJcbiAgICovXHJcbiAgc3RhdGljIGltYWdlQWx0Zm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XHJcbiAgICByZXR1cm4gcmVzdGF1cmFudC5pbWFnZUFsdFxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogTWFwIG1hcmtlciBmb3IgYSByZXN0YXVyYW50LlxyXG4gICAqL1xyXG4gIHN0YXRpYyBtYXBNYXJrZXJGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIG1hcCkge1xyXG4gICAgLy8gaHR0cHM6Ly9sZWFmbGV0anMuY29tL3JlZmVyZW5jZS0xLjMuMC5odG1sI21hcmtlclxyXG4gICAgY29uc3QgbWFya2VyID0gbmV3IEwubWFya2VyKFxyXG4gICAgICBbcmVzdGF1cmFudC5sYXRsbmcubGF0LCByZXN0YXVyYW50LmxhdGxuZy5sbmddLFxyXG4gICAgICB7XHJcbiAgICAgICAgdGl0bGU6IHJlc3RhdXJhbnQubmFtZSxcclxuICAgICAgICBhbHQ6IHJlc3RhdXJhbnQubmFtZSxcclxuICAgICAgICB1cmw6IERCSGVscGVyLnVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudClcclxuICAgICAgfVxyXG4gICAgKVxyXG4gICAgbWFya2VyLmFkZFRvKG5ld01hcClcclxuICAgIHJldHVybiBtYXJrZXJcclxuICB9XHJcblxyXG4gIHN0YXRpYyBzZW5kVG9nZ2xlRmF2KGlkLCBhZGQpIHtcclxuICAgIGxldCBmYXZIZWFkZXJzID0gbmV3IEhlYWRlcnMoKVxyXG4gICAgZmF2SGVhZGVycy5hcHBlbmQoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJylcclxuICAgIGNvbnNvbGUubG9nKGFkZCk7XHJcbiAgICBcclxuICAgIGxldCB1cmwgPSBgaHR0cDovL2xvY2FsaG9zdDoxMzM3L3Jlc3RhdXJhbnRzLyR7aWR9Lz9pc19mYXZvcml0ZT0ke2FkZH1gXHJcbiAgICBsZXQgb3B0aW9ucyA9IHtcclxuICAgICAgbWV0aG9kOiAnUFVUJyxcclxuICAgICAgbW9kZTogJ2NvcnMnLFxyXG4gICAgICBjYWNoZTogJ25vLWNhY2hlJyxcclxuICAgICAgY3JlZGVudGlhbHM6ICdzYW1lLW9yaWdpbicsXHJcbiAgICB9XHJcbiAgICB0aGlzLnNlbmRSZXF1ZXN0KHVybCwgb3B0aW9ucylcclxuICB9XHJcblxyXG4gIHN0YXRpYyBhZGRSZXZpZXdzKHJldmlldykge1xyXG4gICAgbGV0IHJldmlld0hlYWRlcnMgPSBuZXcgSGVhZGVycygpXHJcbiAgICByZXZpZXdIZWFkZXJzLmFwcGVuZCgnQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKVxyXG5cclxuICAgIGxldCBvcHRpb25zID0ge1xyXG4gICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgbW9kZTogJ2NvcnMnLFxyXG4gICAgICBjYWNoZTogJ25vLWNhY2hlJyxcclxuICAgICAgY3JlZGVudGlhbHM6ICdzYW1lLW9yaWdpbicsXHJcbiAgICAgIGhlYWRlcnM6IHJldmlld0hlYWRlcnMsXHJcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHJldmlldylcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLnNlbmRSZXF1ZXN0KCdodHRwOi8vbG9jYWxob3N0OjEzMzcvcmV2aWV3cy8nLCBvcHRpb25zKVxyXG4gIH1cclxuXHJcbiAgc3RhdGljIHNlbmRSZXF1ZXN0KHVybCwgb3B0aW9ucykge1xyXG4gICAgZmV0Y2godXJsLCBvcHRpb25zKVxyXG4gICAgICAudGhlbihyZXNwb25zZSA9PiB7XHJcbiAgICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xyXG4gICAgICAgICAgdGhyb3cgRXJyb3IocmVzcG9uc2Uuc3RhdHVzVGV4dClcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKVxyXG4gICAgICB9KVxyXG4gICAgICAudGhlbigoZGF0YSkgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdTZW50JywgZGF0YSlcclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKGVycm9yID0+IGNvbnNvbGUubG9nKCdGYWlsZWQnLCBlcnJvcikpXHJcbiAgfVxyXG59XHJcbiJdfQ==
