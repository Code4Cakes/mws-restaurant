"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,n){for(var t=0;t<n.length;t++){var u=n[t];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(e,u.key,u)}}function _createClass(e,n,t){return n&&_defineProperties(e.prototype,n),t&&_defineProperties(e,t),e}var DBHelper=function(){function i(){_classCallCheck(this,i)}return _createClass(i,null,[{key:"fetchRestaurants",value:function(t){fetch("".concat(i.DATABASE_URL,"/restaurants")).then(function(e){if(200===e.status)e.json().then(function(e){t(null,e)});else{var n="Request failed. Returned status of ".concat(xhr.status);t(n,null)}}).catch(function(e){})}},{key:"fetchReviews",value:function(t){fetch("".concat(i.DATABASE_URL,"/reviews")).then(function(e){if(200===e.status)e.json().then(function(e){t(null,e)});else{var n="Request failed. Returned status of ".concat(xhr.status);t(n,null)}}).catch(function(e){})}},{key:"fetchRestaurantById",value:function(u,r){i.fetchRestaurants(function(e,n){if(e)r(e,null);else{var t=n.find(function(e){return e.id==u});t?r(null,t):r("Restaurant does not exist",null)}})}},{key:"fetchReviewsByRestaurantId",value:function(u,r){i.fetchReviews(function(e,n){if(e)r(e,null);else{var t=n.filter(function(e){return e.restaurant_id==u});t?r(null,t):r("No reviews not exist",null)}})}},{key:"fetchRestaurantByCuisine",value:function(u,r){i.fetchRestaurants(function(e,n){if(e)r(e,null);else{var t=n.filter(function(e){return e.cuisine_type==u});r(null,t)}})}},{key:"fetchRestaurantByNeighborhood",value:function(u,r){i.fetchRestaurants(function(e,n){if(e)r(e,null);else{var t=n.filter(function(e){return e.neighborhood==u});r(null,t)}})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(u,r,a){i.fetchRestaurants(function(e,n){if(e)a(e,null);else{var t=n;"all"!=u&&(t=t.filter(function(e){return e.cuisine_type==u})),"all"!=r&&(t=t.filter(function(e){return e.neighborhood==r})),a(null,t)}})}},{key:"fetchNeighborhoods",value:function(r){i.fetchRestaurants(function(e,t){if(e)r(e,null);else{var u=t.map(function(e,n){return t[n].neighborhood}),n=u.filter(function(e,n){return u.indexOf(e)==n});r(null,n)}})}},{key:"fetchCuisines",value:function(r){i.fetchRestaurants(function(e,t){if(e)r(e,null);else{var u=t.map(function(e,n){return t[n].cuisine_type}),n=u.filter(function(e,n){return u.indexOf(e)==n});r(null,n)}})}},{key:"urlForRestaurant",value:function(e){return"./restaurant.html?id=".concat(e.id)}},{key:"imageUrlForRestaurant",value:function(e){return"public/img/".concat(e.id,".jpg")}},{key:"imageAltforRestaurant",value:function(e){return e.imageAlt}},{key:"mapMarkerForRestaurant",value:function(e,n){var t=new L.marker([e.latlng.lat,e.latlng.lng],{title:e.name,alt:e.name,url:i.urlForRestaurant(e)});return t.addTo(newMap),t}},{key:"DATABASE_URL",get:function(){return"http://localhost:".concat(1337)}}]),i}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRiaGVscGVyLmpzIl0sIm5hbWVzIjpbIkRCSGVscGVyIiwiY2FsbGJhY2siLCJmZXRjaCIsImNvbmNhdCIsIkRBVEFCQVNFX1VSTCIsInRoZW4iLCJyZXMiLCJzdGF0dXMiLCJqc29uIiwicmVzdGF1cmFudHMiLCJlcnJvciIsInhociIsImNhdGNoIiwicmV2aWV3cyIsImlkIiwiZmV0Y2hSZXN0YXVyYW50cyIsInJlc3RhdXJhbnQiLCJmaW5kIiwiciIsImZldGNoUmV2aWV3cyIsInJldmlld0xpc3QiLCJmaWx0ZXIiLCJyZXN0YXVyYW50X2lkIiwiY3Vpc2luZSIsInJlc3VsdHMiLCJjdWlzaW5lX3R5cGUiLCJuZWlnaGJvcmhvb2QiLCJuZWlnaGJvcmhvb2RzIiwibWFwIiwidiIsImkiLCJ1bmlxdWVOZWlnaGJvcmhvb2RzIiwiaW5kZXhPZiIsImN1aXNpbmVzIiwidW5pcXVlQ3Vpc2luZXMiLCJpbWFnZUFsdCIsIm1hcmtlciIsIkwiLCJsYXRsbmciLCJsYXQiLCJsbmciLCJ0aXRsZSIsIm5hbWUiLCJhbHQiLCJ1cmwiLCJ1cmxGb3JSZXN0YXVyYW50IiwiYWRkVG8iLCJuZXdNYXAiXSwibWFwcGluZ3MiOiJ1WkFHTUEsNEhBYW9CQyxHQUN0QkMsTUFBSyxHQUFBQyxPQUFJSCxFQUFTSSxhQUFiLGlCQUF5Q0MsS0FBSyxTQUFBQyxHQUNqRCxHQUFtQixNQUFmQSxFQUFJQyxPQUVORCxFQUFJRSxPQUFPSCxLQUFLLFNBQUNJLEdBQ2ZSLEVBQVMsS0FBTVEsU0FFWixDQUVMLElBQU1DLEVBQUssc0NBQUFQLE9BQXlDUSxJQUFJSixRQUN4RE4sRUFBU1MsRUFBTyxTQUVqQkUsTUFBTSxTQUFBRiwyQ0FRU1QsR0FDbEJDLE1BQUssR0FBQUMsT0FBSUgsRUFBU0ksYUFBYixhQUFxQ0MsS0FBSyxTQUFBQyxHQUM3QyxHQUFtQixNQUFmQSxFQUFJQyxPQUdORCxFQUFJRSxPQUFPSCxLQUFLLFNBQUNRLEdBQ2ZaLEVBQVMsS0FBTVksU0FFWixDQUVMLElBQU1I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ci5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQ29tbW9uIGRhdGFiYXNlIGhlbHBlciBmdW5jdGlvbnMuXHJcbiAqL1xyXG5jbGFzcyBEQkhlbHBlciB7XHJcbiAgLyoqXHJcbiAgICogRGF0YWJhc2UgVVJMLlxyXG4gICAqIENoYW5nZSB0aGlzIHRvIHJlc3RhdXJhbnRzLmpzb24gZmlsZSBsb2NhdGlvbiBvbiB5b3VyIHNlcnZlci5cclxuICAgKi9cclxuICBzdGF0aWMgZ2V0IERBVEFCQVNFX1VSTCgpIHtcclxuICAgIGNvbnN0IHBvcnQgPSAxMzM3IC8vIENoYW5nZSB0aGlzIHRvIHlvdXIgc2VydmVyIHBvcnRcclxuICAgIHJldHVybiBgaHR0cDovL2xvY2FsaG9zdDoke3BvcnR9YFxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYWxsIHJlc3RhdXJhbnRzLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRzKGNhbGxiYWNrKSB7XHJcbiAgICBmZXRjaChgJHtEQkhlbHBlci5EQVRBQkFTRV9VUkx9L3Jlc3RhdXJhbnRzYCkudGhlbihyZXMgPT4ge1xyXG4gICAgICBpZiAocmVzLnN0YXR1cyA9PT0gMjAwKSB7XHJcbiAgICAgICAgLy8gR290IGEgc3VjY2VzcyByZXNwb25zZSBmcm9tIHNlcnZlciFcclxuICAgICAgICByZXMuanNvbigpLnRoZW4oKHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgICAgICBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50cylcclxuICAgICAgICB9KVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIE9vcHMhLiBHb3QgYW4gZXJyb3IgZnJvbSBzZXJ2ZXIuXHJcbiAgICAgICAgY29uc3QgZXJyb3IgPSBgUmVxdWVzdCBmYWlsZWQuIFJldHVybmVkIHN0YXR1cyBvZiAke3hoci5zdGF0dXN9YFxyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKVxyXG4gICAgICB9XHJcbiAgICB9KS5jYXRjaChlcnJvciA9PiB7XHJcbiAgICAgIC8vIGNvbnNvbGUubG9nKGVycm9yKVxyXG4gICAgfSlcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGFsbCByZXZpZXdzLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJldmlld3MoY2FsbGJhY2spIHtcclxuICAgIGZldGNoKGAke0RCSGVscGVyLkRBVEFCQVNFX1VSTH0vcmV2aWV3c2ApLnRoZW4ocmVzID0+IHtcclxuICAgICAgaWYgKHJlcy5zdGF0dXMgPT09IDIwMCkge1xyXG4gICAgICAgIC8vIEdvdCBhIHN1Y2Nlc3MgcmVzcG9uc2UgZnJvbSBzZXJ2ZXIhXHJcblxyXG4gICAgICAgIHJlcy5qc29uKCkudGhlbigocmV2aWV3cykgPT4ge1xyXG4gICAgICAgICAgY2FsbGJhY2sobnVsbCwgcmV2aWV3cylcclxuICAgICAgICB9KVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIE9vcHMhLiBHb3QgYW4gZXJyb3IgZnJvbSBzZXJ2ZXIuXHJcbiAgICAgICAgY29uc3QgZXJyb3IgPSBgUmVxdWVzdCBmYWlsZWQuIFJldHVybmVkIHN0YXR1cyBvZiAke3hoci5zdGF0dXN9YFxyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKVxyXG4gICAgICB9XHJcbiAgICB9KS5jYXRjaChlcnJvciA9PiB7XHJcbiAgICAgIC8vIGNvbnNvbGUubG9nKGVycm9yKVxyXG4gICAgfSlcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGEgcmVzdGF1cmFudCBieSBpdHMgSUQuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5SWQoaWQsIGNhbGxiYWNrKSB7XHJcbiAgICAvLyBmZXRjaCBhbGwgcmVzdGF1cmFudHMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpXHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uc3QgcmVzdGF1cmFudCA9IHJlc3RhdXJhbnRzLmZpbmQociA9PiByLmlkID09IGlkKVxyXG4gICAgICAgIGlmIChyZXN0YXVyYW50KSB7XHJcbiAgICAgICAgICAvLyBHb3QgdGhlIHJlc3RhdXJhbnRcclxuICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnQpXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIC8vIFJlc3RhdXJhbnQgZG9lcyBub3QgZXhpc3QgaW4gdGhlIGRhdGFiYXNlXHJcbiAgICAgICAgICBjYWxsYmFjaygnUmVzdGF1cmFudCBkb2VzIG5vdCBleGlzdCcsIG51bGwpXHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYWxsIHJldmlldyBieSByZXN0YXVyYW50IElELlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJldmlld3NCeVJlc3RhdXJhbnRJZChpZCwgY2FsbGJhY2spIHtcclxuICAgIC8vIGZldGNoIGFsbCByZXZpZXdzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXZpZXdzKChlcnJvciwgcmV2aWV3cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbClcclxuICAgICAgfSBlbHNlIHsgICAgICAgIFxyXG4gICAgICAgIGNvbnN0IHJldmlld0xpc3QgPSByZXZpZXdzLmZpbHRlcihyID0+IHIucmVzdGF1cmFudF9pZCA9PSBpZClcclxuICAgICAgICBpZiAocmV2aWV3TGlzdCkge1xyXG4gICAgICAgICAgLy8gR290IHRoZSByZXZpZXdMaXN0XHJcbiAgICAgICAgICBjYWxsYmFjayhudWxsLCByZXZpZXdMaXN0KVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAvLyBSZXN0YXVyYW50IGRvZXMgbm90IGV4aXN0IGluIHRoZSBkYXRhYmFzZVxyXG4gICAgICAgICAgY2FsbGJhY2soJ05vIHJldmlld3Mgbm90IGV4aXN0JywgbnVsbClcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgdHlwZSB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lKGN1aXNpbmUsIGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHMgIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nXHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpXHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gRmlsdGVyIHJlc3RhdXJhbnRzIHRvIGhhdmUgb25seSBnaXZlbiBjdWlzaW5lIHR5cGVcclxuICAgICAgICBjb25zdCByZXN1bHRzID0gcmVzdGF1cmFudHMuZmlsdGVyKHIgPT4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZSlcclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKVxyXG4gICAgICB9XHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5TmVpZ2hib3Job29kKG5laWdoYm9yaG9vZCwgY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIEZpbHRlciByZXN0YXVyYW50cyB0byBoYXZlIG9ubHkgZ2l2ZW4gbmVpZ2hib3Job29kXHJcbiAgICAgICAgY29uc3QgcmVzdWx0cyA9IHJlc3RhdXJhbnRzLmZpbHRlcihyID0+IHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZClcclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKVxyXG4gICAgICB9XHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBjdWlzaW5lIGFuZCBhIG5laWdoYm9yaG9vZCB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kKFxyXG4gICAgY3Vpc2luZSxcclxuICAgIG5laWdoYm9yaG9vZCxcclxuICAgIGNhbGxiYWNrXHJcbiAgKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbClcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBsZXQgcmVzdWx0cyA9IHJlc3RhdXJhbnRzXHJcbiAgICAgICAgaWYgKGN1aXNpbmUgIT0gJ2FsbCcpIHtcclxuICAgICAgICAgIC8vIGZpbHRlciBieSBjdWlzaW5lXHJcbiAgICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIociA9PiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lKVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAobmVpZ2hib3Job29kICE9ICdhbGwnKSB7XHJcbiAgICAgICAgICAvLyBmaWx0ZXIgYnkgbmVpZ2hib3Job29kXHJcbiAgICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIociA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpXHJcbiAgICAgIH1cclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhbGwgbmVpZ2hib3Job29kcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hOZWlnaGJvcmhvb2RzKGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbClcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBHZXQgYWxsIG5laWdoYm9yaG9vZHMgZnJvbSBhbGwgcmVzdGF1cmFudHNcclxuICAgICAgICBjb25zdCBuZWlnaGJvcmhvb2RzID0gcmVzdGF1cmFudHMubWFwKFxyXG4gICAgICAgICAgKHYsIGkpID0+IHJlc3RhdXJhbnRzW2ldLm5laWdoYm9yaG9vZFxyXG4gICAgICAgIClcclxuICAgICAgICAvLyBSZW1vdmUgZHVwbGljYXRlcyBmcm9tIG5laWdoYm9yaG9vZHNcclxuICAgICAgICBjb25zdCB1bmlxdWVOZWlnaGJvcmhvb2RzID0gbmVpZ2hib3Job29kcy5maWx0ZXIoXHJcbiAgICAgICAgICAodiwgaSkgPT4gbmVpZ2hib3Job29kcy5pbmRleE9mKHYpID09IGlcclxuICAgICAgICApXHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgdW5pcXVlTmVpZ2hib3Job29kcylcclxuICAgICAgfVxyXG4gICAgfSlcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGFsbCBjdWlzaW5lcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hDdWlzaW5lcyhjYWxsYmFjaykge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpXHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gR2V0IGFsbCBjdWlzaW5lcyBmcm9tIGFsbCByZXN0YXVyYW50c1xyXG4gICAgICAgIGNvbnN0IGN1aXNpbmVzID0gcmVzdGF1cmFudHMubWFwKCh2LCBpKSA9PiByZXN0YXVyYW50c1tpXS5jdWlzaW5lX3R5cGUpXHJcbiAgICAgICAgLy8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBjdWlzaW5lc1xyXG4gICAgICAgIGNvbnN0IHVuaXF1ZUN1aXNpbmVzID0gY3Vpc2luZXMuZmlsdGVyKFxyXG4gICAgICAgICAgKHYsIGkpID0+IGN1aXNpbmVzLmluZGV4T2YodikgPT0gaVxyXG4gICAgICAgIClcclxuICAgICAgICBjYWxsYmFjayhudWxsLCB1bmlxdWVDdWlzaW5lcylcclxuICAgICAgfVxyXG4gICAgfSlcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlc3RhdXJhbnQgcGFnZSBVUkwuXHJcbiAgICovXHJcbiAgc3RhdGljIHVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xyXG4gICAgcmV0dXJuIGAuL3Jlc3RhdXJhbnQuaHRtbD9pZD0ke3Jlc3RhdXJhbnQuaWR9YFxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzdGF1cmFudCBpbWFnZSBVUkwuXHJcbiAgICovXHJcbiAgc3RhdGljIGltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XHJcbiAgICByZXR1cm4gYHB1YmxpYy9pbWcvJHtyZXN0YXVyYW50LmlkfS5qcGdgXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXN0YXVyYW50IGltYWdlIGFsdCB0YWdcclxuICAgKi9cclxuICBzdGF0aWMgaW1hZ2VBbHRmb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcclxuICAgIHJldHVybiByZXN0YXVyYW50LmltYWdlQWx0XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBNYXAgbWFya2VyIGZvciBhIHJlc3RhdXJhbnQuXHJcbiAgICovXHJcbiAgc3RhdGljIG1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgbWFwKSB7XHJcbiAgICAvLyBodHRwczovL2xlYWZsZXRqcy5jb20vcmVmZXJlbmNlLTEuMy4wLmh0bWwjbWFya2VyXHJcbiAgICBjb25zdCBtYXJrZXIgPSBuZXcgTC5tYXJrZXIoXHJcbiAgICAgIFtyZXN0YXVyYW50LmxhdGxuZy5sYXQsIHJlc3RhdXJhbnQubGF0bG5nLmxuZ10sXHJcbiAgICAgIHtcclxuICAgICAgICB0aXRsZTogcmVzdGF1cmFudC5uYW1lLFxyXG4gICAgICAgIGFsdDogcmVzdGF1cmFudC5uYW1lLFxyXG4gICAgICAgIHVybDogREJIZWxwZXIudXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KVxyXG4gICAgICB9XHJcbiAgICApXHJcbiAgICBtYXJrZXIuYWRkVG8obmV3TWFwKVxyXG4gICAgcmV0dXJuIG1hcmtlclxyXG4gIH1cclxufVxyXG4iXX0=
