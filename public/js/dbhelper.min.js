"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var DBHelper=function(){function r(){_classCallCheck(this,r)}return _createClass(r,null,[{key:"fetchRestaurants",value:function(n){fetch("".concat(r.DATABASE_URL,"/restaurants")).then(function(e){if(200===e.status)e.json().then(function(e){n(null,e)});else{var t="Request failed. Returned status of ".concat(xhr.status);n(t,null)}}).catch(function(e){})}},{key:"fetchReviews",value:function(n){fetch("".concat(r.DATABASE_URL,"/reviews")).then(function(e){if(200===e.status)e.json().then(function(e){n(null,e)});else{var t="Request failed. Returned status of ".concat(xhr.status);n(t,null)}}).catch(function(e){})}},{key:"fetchRestaurantById",value:function(a,o){r.fetchRestaurants(function(e,t){if(e)o(e,null);else{var n=t.find(function(e){return e.id==a});n?o(null,n):o("Restaurant does not exist",null)}})}},{key:"fetchReviewsByRestaurantId",value:function(e,n){fetch("".concat(r.DATABASE_URL,"/reviews/?restaurant_id=").concat(e)).then(function(e){if(200===e.status)e.json().then(function(e){n(null,e)});else{var t="Request failed. Returned status of ".concat(xhr.status);n(t,null)}}).catch(function(e){})}},{key:"fetchRestaurantByCuisine",value:function(a,o){r.fetchRestaurants(function(e,t){if(e)o(e,null);else{var n=t.filter(function(e){return e.cuisine_type==a});o(null,n)}})}},{key:"fetchRestaurantByNeighborhood",value:function(a,o){r.fetchRestaurants(function(e,t){if(e)o(e,null);else{var n=t.filter(function(e){return e.neighborhood==a});o(null,n)}})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(a,o,i){r.fetchRestaurants(function(e,t){if(e)i(e,null);else{var n=t;"all"!=a&&(n=n.filter(function(e){return e.cuisine_type==a})),"all"!=o&&(n=n.filter(function(e){return e.neighborhood==o})),i(null,n)}})}},{key:"fetchNeighborhoods",value:function(o){r.fetchRestaurants(function(e,n){if(e)o(e,null);else{var a=n.map(function(e,t){return n[t].neighborhood}),t=a.filter(function(e,t){return a.indexOf(e)==t});o(null,t)}})}},{key:"fetchCuisines",value:function(o){r.fetchRestaurants(function(e,n){if(e)o(e,null);else{var a=n.map(function(e,t){return n[t].cuisine_type}),t=a.filter(function(e,t){return a.indexOf(e)==t});o(null,t)}})}},{key:"urlForRestaurant",value:function(e){return"./restaurant.html?id=".concat(e.id)}},{key:"imageUrlForRestaurant",value:function(e){return"public/img/".concat(e.id,".jpg")}},{key:"imageAltforRestaurant",value:function(e){return e.imageAlt}},{key:"mapMarkerForRestaurant",value:function(e,t){var n=new L.marker([e.latlng.lat,e.latlng.lng],{title:e.name,alt:e.name,url:r.urlForRestaurant(e)});return n.addTo(newMap),n}},{key:"sendToggleFav",value:function(t,n){var a=this;navigator.onLine?fetch("http://localhost:1337/restaurants/".concat(t,"/?is_favorite=").concat(n),{method:"PUT",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:new Headers({"Content-Type":"application/json"})}).then(function(e){return a.setFavoriteLocalDb({id:t,is_favorite:n})}).catch(function(){a.setFavoriteLocalDb({id:t-1,is_favorite:n})}):(console.log(t),console.log(n),this.setFavoriteLocalDb({id:t,is_favorite:n}))}},{key:"fetchLocalDb",value:function(t,n){return this.dbPromise.then(function(e){return e.transaction(t).objectStore(t).get(n)})}},{key:"putLocalDb",value:function(t,n,a){this.dbPromise.then(function(e){e.transaction(n,"readwrite").objectStore(n).put(t,a)}).catch(function(e){console.log(e)})}},{key:"setFavoriteLocalDb",value:function(t){var n=this,a=t.id-1;this.fetchLocalDb("restaurants",0).then(function(e){e[a].is_favorite=t.is_favorite,n.putLocalDb(e,"restaurants",0)})}},{key:"addReview",value:function(e){var t=this;navigator.onLine?fetch("http://localhost:1337/reviews/",{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:new Headers({"Content-Type":"application/json"}),body:JSON.stringify(e)}).then(function(e){t.storeReviewLocalDb(e)}).catch(function(){t.storeReviewLocalDb(e)}):this.storeReviewLocalDb(e)}},{key:"storeReviewLocalDb",value:function(t){var n=this,a=t.restaurant_id;this.fetchLocalDb("reviews",a).then(function(e){e.push(t),n.putLocalDb(e,"reviews",a)})}},{key:"DATABASE_URL",get:function(){return"http://localhost:".concat(1337)}},{key:"dbPromise",get:function(){return idb.open("restaurandDb",3,function(e){switch(e.oldVersion){case 0:e.createObjectStore("restaurants");case 1:e.createObjectStore("reviews")}})}}]),r}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRiaGVscGVyLmpzIl0sIm5hbWVzIjpbIkRCSGVscGVyIiwiY2FsbGJhY2siLCJmZXRjaCIsImNvbmNhdCIsIkRBVEFCQVNFX1VSTCIsInRoZW4iLCJyZXMiLCJzdGF0dXMiLCJqc29uIiwicmVzdGF1cmFudHMiLCJlcnJvciIsInhociIsImNhdGNoIiwicmV2aWV3cyIsImlkIiwiZmV0Y2hSZXN0YXVyYW50cyIsInJlc3RhdXJhbnQiLCJmaW5kIiwiciIsImN1aXNpbmUiLCJyZXN1bHRzIiwiZmlsdGVyIiwiY3Vpc2luZV90eXBlIiwibmVpZ2hib3Job29kIiwibmVpZ2hib3Job29kcyIsIm1hcCIsInYiLCJpIiwidW5pcXVlTmVpZ2hib3Job29kcyIsImluZGV4T2YiLCJjdWlzaW5lcyIsInVuaXF1ZUN1aXNpbmVzIiwiaW1hZ2VBbHQiLCJtYXJrZXIiLCJMIiwibGF0bG5nIiwibGF0IiwibG5nIiwidGl0bGUiLCJuYW1lIiwiYWx0IiwidXJsIiwidXJsRm9yUmVzdGF1cmFudCIsImFkZFRvIiwibmV3TWFwIiwiYWRkIiwiX3RoaXMiLCJ0aGlzIiwibmF2aWdhdG9yIiwib25MaW5lIiwibWV0aG9kIiwibW9kZSIsImNhY2hlIiwiY3JlZGVudGlhbHMiLCJoZWFkZXJzIiwiSGVhZGVycyIsIkNvbnRlbnQtVHlwZSIsInJlc3BvbnNlIiwic2V0RmF2b3JpdGVMb2NhbERiIiwiaXNfZmF2b3JpdGUiLCJjb25zb2xlIiwibG9nIiwic3RvcmUiLCJrZXkiLCJkYlByb21pc2UiLCJkYiIsInRyYW5zYWN0aW9uIiwib2JqZWN0U3RvcmUiLCJnZXQiLCJkYXRhIiwicHV0IiwiZSIsIl90aGlzMiIsImpzb25JbmRleCIsImZldGNoTG9jYWxEYiIsInJlc3RhdXJhbnRMaXN0IiwicHV0TG9jYWxEYiIsInJldmlldyIsIl90aGlzMyIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5Iiwic3RvcmVSZXZpZXdMb2NhbERiIiwiX3RoaXM0IiwicmVzdGF1cmFudF9pZCIsInJldmlld0xpc3QiLCJwdXNoIiwiaWRiIiwib3BlbiIsInVwZ3JhZGVEYiIsIm9sZFZlcnNpb24iLCJjcmVhdGVPYmplY3RTdG9yZSJdLCJtYXBwaW5ncyI6InVaQUdNQSw0SEF3Qm9CQyxHQUN0QkMsTUFBSyxHQUFBQyxPQUFJSCxFQUFTSSxhQUFiLGlCQUF5Q0MsS0FBSyxTQUFBQyxHQUNqRCxHQUFtQixNQUFmQSxFQUFJQyxPQUVORCxFQUFJRSxPQUFPSCxLQUFLLFNBQUNJLEdBQ2ZSLEVBQVMsS0FBTVEsU0FFWixDQUVMLElBQU1DLEVBQUssc0NBQUFQLE9BQXlDUSxJQUFJSixRQUN4RE4sRUFBU1MsRUFBTyxTQUVqQkUsTUFBTSxTQUFBRiwyQ0FRU1QsR0FDbEJDLE1BQUssR0FBQUMsT0FBSUgsRUFBU0ksYUFBYixhQUFxQ0MsS0FBSyxTQUFBQyxHQUM3QyxHQUFtQixNQUFmQSxFQUFJQyxPQUdORCxFQUFJRSxPQUFPSCxLQUFLLFNBQUNRLEdBQ2ZaLEVBQVMsS0FBTVksU0FFWixDQUVMLElBQU1ILEVBQUssc0NBQUFQLE9BQXlDUSxJQUFJSixRQUN4RE4sRUFBU1MsRUFBTyxTQUVqQkUsTUFBTSxTQUFBRixrREFRZ0JJLEVBQUliLEdBRTdCRCxFQUFTZSxpQkFBaUIsU0FBQ0wsRUFBT0QsR0FDaEMsR0FBSUMsRUFDRlQsRUFBU1MsRUFBTyxVQUNYLENBQ0wsSUFBTU0sRUFBYVAsRUFBWVEsS0FBSyxTQUFBQyxHQUFDLE9BQUlBLEVBQUVKLElBQU1BLElBQzdDRSxFQUVGZixFQUFTLEtBQU1lLEdBR2ZmLEVBQVMsNEJBQTZCLDREQVNaYSxFQUFJYixHQUVwQ0MsTUFBSyxHQUFBQyxPQUFJSCxFQUFTSSxhQUFiLDRCQUFBRCxPQUFvRFcsSUFDdERULEtBQUssU0FBQUMsR0FDSixHQUFtQixNQUFmQSxFQUFJQyxPQUVORCxFQUFJRSxPQUFPSCxLQUFLLFNBQUNRLEdBQ2ZaLEVBQVMsS0FBTVksU0FFWixDQUVMLElBQU1ILEVBQUssc0NBQUFQLE9BQXlDUSxJQUFJSixRQUN4RE4sRUFBU1MsRUFBTyxTQUVqQkUsTUFBTSxTQUFBRix1REFRbUJTLEVBQVNsQixHQUV2Q0QsRUFBU2UsaUJBQWlCLFNBQUNMLEVBQU9ELEdBQ2hDLEdBQUlDLEVBQ0ZULEVBQVNTLEVBQU8sVUFDWCxDQUVMLElBQU1VLEVBQVVYLEVBQVlZLE9BQU8sU0FBQUgsR0FBQyxPQUFJQSxFQUFFSSxjQUFnQkgsSUFDMURsQixFQUFTLEtBQU1tQiw0REFRZ0JHLEVBQWN0QixHQUVqREQsRUFBU2UsaUJBQWlCLFNBQUNMLEVBQU9ELEdBQ2hDLEdBQUlDLEVBQ0ZULEVBQVNTLEVBQU8sVUFDWCxDQUVMLElBQU1VLEVBQVVYLEVBQVlZLE9BQU8sU0FBQUgsR0FBQyxPQUFJQSxFQUFFSyxjQUFnQkEsSUFDMUR0QixFQUFTLEtBQU1tQixzRUFTbkJELEVBQ0FJLEVBQ0F0QixHQUdBRCxFQUFTZSxpQkFBaUIsU0FBQ0wsRUFBT0QsR0FDaEMsR0FBSUMsRUFDRlQsRUFBU1MsRUFBTyxVQUNYLENBQ0wsSUFBSVUsRUFBVVgsRUFDQyxPQUFYVSxJQUVGQyxFQUFVQSxFQUFRQyxPQUFPLFNBQUFILEdBQUMsT0FBSUEsRUFBRUksY0FBZ0JILEtBRTlCLE9BQWhCSSxJQUVGSCxFQUFVQSxFQUFRQyxPQUFPLFNBQUFILEdBQUMsT0FBSUEsRUFBRUssY0FBZ0JBLEtBRWxEdEIsRUFBUyxLQUFNbUIsaURBUUtuQixHQUV4QkQsRUFBU2UsaUJBQWlCLFNBQUNMLEVBQU9ELEdBQ2hDLEdBQUlDLEVBQ0ZULEVBQVNTLEVBQU8sVUFDWCxDQUVMLElBQU1jLEVBQWdCZixFQUFZZ0IsSUFDaEMsU0FBQ0MsRUFBR0MsR0FBSixPQUFVbEIsRUFBWWtCLEdBQUdKLGVBR3JCSyxFQUFzQkosRUFBY0gsT0FDeEMsU0FBQ0ssRUFBR0MsR0FBSixPQUFVSCxFQUFjSyxRQUFRSCxJQUFNQyxJQUV4QzFCLEVBQVMsS0FBTTJCLDRDQVFBM0IsR0FFbkJELEVBQVNlLGlCQUFpQixTQUFDTCxFQUFPRCxHQUNoQyxHQUFJQyxFQUNGVCxFQUFTUyxFQUFPLFVBQ1gsQ0FFTCxJQUFNb0IsRUFBV3JCLEVBQVlnQixJQUFJLFNBQUNDLEVBQUdDLEdBQUosT0FBVWxCLEVBQVlrQixHQUFHTCxlQUVwRFMsRUFBaUJELEVBQVNULE9BQzlCLFNBQUNLLEVBQUdDLEdBQUosT0FBVUcsRUFBU0QsUUFBUUgsSUFBTUMsSUFFbkMxQixFQUFTLEtBQU04QiwrQ0FRR2YsR0FDdEIsTUFBQSx3QkFBQWIsT0FBK0JhLEVBQVdGLGtEQU1mRSxHQUMzQixNQUFBLGNBQUFiLE9BQXFCYSxFQUFXRixHQUFoQyxzREFNMkJFLEdBQzNCLE9BQU9BLEVBQVdnQix3REFNVWhCLEVBQVlTLEdBRXhDLElBQU1RLEVBQVMsSUFBSUMsRUFBRUQsT0FDbkIsQ0FBQ2pCLEVBQVdtQixPQUFPQyxJQUFLcEIsRUFBV21CLE9BQU9FLEtBQzFDLENBQ0VDLE1BQU90QixFQUFXdUIsS0FDbEJDLElBQUt4QixFQUFXdUIsS0FDaEJFLElBQUt6QyxFQUFTMEMsaUJBQWlCMUIsS0FJbkMsT0FEQWlCLEVBQU9VLE1BQU1DLFFBQ05YLHdDQU1ZbkIsRUFBSStCLEdBQUssSUFBQUMsRUFBQUMsS0FDeEJDLFVBQVVDLE9BQ1ovQyxNQUFLLHFDQUFBQyxPQUFzQ1csRUFBdEMsa0JBQUFYLE9BQXlEMEMsR0FBTyxDQUNuRUssT0FBUSxNQUNSQyxLQUFNLE9BQ05DLE1BQU8sV0FDUEMsWUFBYSxjQUNiQyxRQUFTLElBQUlDLFFBQVEsQ0FBRUMsZUFBZ0IsdUJBRXRDbkQsS0FBSyxTQUFBb0QsR0FDSixPQUFPWCxFQUFLWSxtQkFBbUIsQ0FDN0I1QyxHQUFJQSxFQUNKNkMsWUFBYWQsTUFHaEJqQyxNQUFNLFdBRUxrQyxFQUFLWSxtQkFBbUIsQ0FDdEI1QyxHQUFJQSxFQUFLLEVBQ1Q2QyxZQUFhZCxPQUtuQmUsUUFBUUMsSUFBSS9DLEdBQ1o4QyxRQUFRQyxJQUFJaEIsR0FDWkUsS0FBS1csbUJBQW1CLENBQ3RCNUMsR0FBSUEsRUFDSjZDLFlBQWFkLDBDQVFDaUIsRUFBT0MsR0FDekIsT0FBT2hCLEtBQUtpQixVQUNUM0QsS0FBSyxTQUFBNEQsR0FDSixPQUFPQSxFQUFHQyxZQUFZSixHQUNuQkssWUFBWUwsR0FDWk0sSUFBSUwsd0NBT0tNLEVBQU1QLEVBQU9DLEdBQzdCaEIsS0FBS2lCLFVBQ0YzRCxLQUFLLFNBQUE0RCxHQUNKQSxFQUFHQyxZQUFZSixFQUFPLGFBQ25CSyxZQUFZTCxHQUNaUSxJQUFJRCxFQUFNTixLQUVkbkQsTUFBTSxTQUFBMkQsR0FDTFgsUUFBUUMsSUFBSVUsZ0RBT1F2RCxHQUFZLElBQUF3RCxFQUFBekIsS0FFOUIwQixFQUFZekQsRUFBV0YsR0FBSyxFQUNsQ2lDLEtBQUsyQixhQUFhLGNBQWUsR0FDOUJyRSxLQUFLLFNBQUFzRSxHQUNKQSxFQUFlRixHQUFXZCxZQUFjM0MsRUFBVzJDLFlBQ25EYSxFQUFLSSxXQUFXRCxFQUFnQixjQUFlLHVDQU9wQ0UsR0FBUSxJQUFBQyxFQUFBL0IsS0FDbkJDLFVBQVVDLE9BQ1ovQyxNQUFNLGlDQUFrQyxDQUN0Q2dELE9BQVEsT0FDUkMsS0FBTSxPQUNOQyxNQUFPLFdBQ1BDLFlBQWEsY0FDYkMsUUFBUyxJQUFJQyxRQUFRLENBQUVDLGVBQWdCLHFCQUN2Q3VCLEtBQU1DLEtBQUtDLFVBQVVKLEtBRXBCeEUsS0FBSyxTQUFBb0QsR0FFSnFCLEVBQUtJLG1CQUFtQnpCLEtBRXpCN0MsTUFBTSxXQUNMa0UsRUFBS0ksbUJBQW1CTCxLQUc1QjlCLEtBQUttQyxtQkFBbUJMLDhDQUtGQSxHQUFRLElBQUFNLEVBQUFwQyxLQUMxQmpDLEVBQUsrRCxFQUFPTyxjQUNsQnJDLEtBQUsyQixhQUFhLFVBQVc1RCxHQUMxQlQsS0FBSyxTQUFBZ0YsR0FDSkEsRUFBV0MsS0FBS1QsR0FDaEJNLEVBQUtQLFdBQVdTLEVBQVksVUFBV3ZFLDBDQXhWM0MsTUFBQSxvQkFBQVgsT0FEYSx3Q0FLYixPQUFPb0YsSUFBSUMsS0FBSyxlQUFnQixFQUFHLFNBQUFDLEdBQ2pDLE9BQVFBLEVBQVVDLFlBQ2hCLEtBQUssRUFDcUJELEVBQVVFLGtCQUFrQixlQUN0RCxLQUFLLEVBQ2lCRixFQUFVRSxrQkFBa0IiLCJmaWxlIjoiZGJoZWxwZXIubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIENvbW1vbiBkYXRhYmFzZSBoZWxwZXIgZnVuY3Rpb25zLlxyXG4gKi9cclxuY2xhc3MgREJIZWxwZXIge1xyXG4gIC8qKlxyXG4gICAqIERhdGFiYXNlIFVSTC5cclxuICAgKiBDaGFuZ2UgdGhpcyB0byByZXN0YXVyYW50cy5qc29uIGZpbGUgbG9jYXRpb24gb24geW91ciBzZXJ2ZXIuXHJcbiAgICovXHJcbiAgc3RhdGljIGdldCBEQVRBQkFTRV9VUkwoKSB7XHJcbiAgICBjb25zdCBwb3J0ID0gMTMzNyAvLyBDaGFuZ2UgdGhpcyB0byB5b3VyIHNlcnZlciBwb3J0XHJcbiAgICByZXR1cm4gYGh0dHA6Ly9sb2NhbGhvc3Q6JHtwb3J0fWBcclxuICB9XHJcblxyXG4gIHN0YXRpYyBnZXQgZGJQcm9taXNlKCkge1xyXG4gICAgcmV0dXJuIGlkYi5vcGVuKCdyZXN0YXVyYW5kRGInLCAzLCB1cGdyYWRlRGIgPT4ge1xyXG4gICAgICBzd2l0Y2ggKHVwZ3JhZGVEYi5vbGRWZXJzaW9uKSB7XHJcbiAgICAgICAgY2FzZSAwOlxyXG4gICAgICAgICAgY29uc3QgcmVzdGF1cmFudFN0b3JlID0gdXBncmFkZURiLmNyZWF0ZU9iamVjdFN0b3JlKCdyZXN0YXVyYW50cycpXHJcbiAgICAgICAgY2FzZSAxOlxyXG4gICAgICAgICAgY29uc3QgcmV2aWV3U3RvcmUgPSB1cGdyYWRlRGIuY3JlYXRlT2JqZWN0U3RvcmUoJ3Jldmlld3MnKVxyXG4gICAgICB9XHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYWxsIHJlc3RhdXJhbnRzLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRzKGNhbGxiYWNrKSB7XHJcbiAgICBmZXRjaChgJHtEQkhlbHBlci5EQVRBQkFTRV9VUkx9L3Jlc3RhdXJhbnRzYCkudGhlbihyZXMgPT4ge1xyXG4gICAgICBpZiAocmVzLnN0YXR1cyA9PT0gMjAwKSB7XHJcbiAgICAgICAgLy8gR290IGEgc3VjY2VzcyByZXNwb25zZSBmcm9tIHNlcnZlciFcclxuICAgICAgICByZXMuanNvbigpLnRoZW4oKHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgICAgICBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50cylcclxuICAgICAgICB9KVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIE9vcHMhLiBHb3QgYW4gZXJyb3IgZnJvbSBzZXJ2ZXIuXHJcbiAgICAgICAgY29uc3QgZXJyb3IgPSBgUmVxdWVzdCBmYWlsZWQuIFJldHVybmVkIHN0YXR1cyBvZiAke3hoci5zdGF0dXN9YFxyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKVxyXG4gICAgICB9XHJcbiAgICB9KS5jYXRjaChlcnJvciA9PiB7XHJcbiAgICAgIC8vIGNvbnNvbGUubG9nKGVycm9yKVxyXG4gICAgfSlcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGFsbCByZXZpZXdzLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJldmlld3MoY2FsbGJhY2spIHtcclxuICAgIGZldGNoKGAke0RCSGVscGVyLkRBVEFCQVNFX1VSTH0vcmV2aWV3c2ApLnRoZW4ocmVzID0+IHtcclxuICAgICAgaWYgKHJlcy5zdGF0dXMgPT09IDIwMCkge1xyXG4gICAgICAgIC8vIEdvdCBhIHN1Y2Nlc3MgcmVzcG9uc2UgZnJvbSBzZXJ2ZXIhXHJcblxyXG4gICAgICAgIHJlcy5qc29uKCkudGhlbigocmV2aWV3cykgPT4ge1xyXG4gICAgICAgICAgY2FsbGJhY2sobnVsbCwgcmV2aWV3cylcclxuICAgICAgICB9KVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIE9vcHMhLiBHb3QgYW4gZXJyb3IgZnJvbSBzZXJ2ZXIuXHJcbiAgICAgICAgY29uc3QgZXJyb3IgPSBgUmVxdWVzdCBmYWlsZWQuIFJldHVybmVkIHN0YXR1cyBvZiAke3hoci5zdGF0dXN9YFxyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKVxyXG4gICAgICB9XHJcbiAgICB9KS5jYXRjaChlcnJvciA9PiB7XHJcbiAgICAgIC8vIGNvbnNvbGUubG9nKGVycm9yKVxyXG4gICAgfSlcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGEgcmVzdGF1cmFudCBieSBpdHMgSUQuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5SWQoaWQsIGNhbGxiYWNrKSB7XHJcbiAgICAvLyBmZXRjaCBhbGwgcmVzdGF1cmFudHMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpXHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uc3QgcmVzdGF1cmFudCA9IHJlc3RhdXJhbnRzLmZpbmQociA9PiByLmlkID09IGlkKVxyXG4gICAgICAgIGlmIChyZXN0YXVyYW50KSB7XHJcbiAgICAgICAgICAvLyBHb3QgdGhlIHJlc3RhdXJhbnRcclxuICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnQpXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIC8vIFJlc3RhdXJhbnQgZG9lcyBub3QgZXhpc3QgaW4gdGhlIGRhdGFiYXNlXHJcbiAgICAgICAgICBjYWxsYmFjaygnUmVzdGF1cmFudCBkb2VzIG5vdCBleGlzdCcsIG51bGwpXHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYWxsIHJldmlldyBieSByZXN0YXVyYW50IElELlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJldmlld3NCeVJlc3RhdXJhbnRJZChpZCwgY2FsbGJhY2spIHtcclxuICAgIC8vIGZldGNoIGFsbCByZXZpZXdzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAgZmV0Y2goYCR7REJIZWxwZXIuREFUQUJBU0VfVVJMfS9yZXZpZXdzLz9yZXN0YXVyYW50X2lkPSR7aWR9YClcclxuICAgICAgLnRoZW4ocmVzID0+IHtcclxuICAgICAgICBpZiAocmVzLnN0YXR1cyA9PT0gMjAwKSB7XHJcbiAgICAgICAgICAvLyBHb3QgYSBzdWNjZXNzIHJlc3BvbnNlIGZyb20gc2VydmVyIVxyXG4gICAgICAgICAgcmVzLmpzb24oKS50aGVuKChyZXZpZXdzKSA9PiB7XHJcbiAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHJldmlld3MpXHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAvLyBPb3BzIS4gR290IGFuIGVycm9yIGZyb20gc2VydmVyLlxyXG4gICAgICAgICAgY29uc3QgZXJyb3IgPSBgUmVxdWVzdCBmYWlsZWQuIFJldHVybmVkIHN0YXR1cyBvZiAke3hoci5zdGF0dXN9YFxyXG4gICAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpXHJcbiAgICAgICAgfVxyXG4gICAgICB9KS5jYXRjaChlcnJvciA9PiB7XHJcbiAgICAgICAgLy8gY29uc29sZS5sb2coZXJyb3IpXHJcbiAgICAgIH0pXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgdHlwZSB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lKGN1aXNpbmUsIGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHMgIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nXHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpXHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gRmlsdGVyIHJlc3RhdXJhbnRzIHRvIGhhdmUgb25seSBnaXZlbiBjdWlzaW5lIHR5cGVcclxuICAgICAgICBjb25zdCByZXN1bHRzID0gcmVzdGF1cmFudHMuZmlsdGVyKHIgPT4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZSlcclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKVxyXG4gICAgICB9XHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5TmVpZ2hib3Job29kKG5laWdoYm9yaG9vZCwgY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIEZpbHRlciByZXN0YXVyYW50cyB0byBoYXZlIG9ubHkgZ2l2ZW4gbmVpZ2hib3Job29kXHJcbiAgICAgICAgY29uc3QgcmVzdWx0cyA9IHJlc3RhdXJhbnRzLmZpbHRlcihyID0+IHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZClcclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKVxyXG4gICAgICB9XHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBjdWlzaW5lIGFuZCBhIG5laWdoYm9yaG9vZCB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kKFxyXG4gICAgY3Vpc2luZSxcclxuICAgIG5laWdoYm9yaG9vZCxcclxuICAgIGNhbGxiYWNrXHJcbiAgKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbClcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBsZXQgcmVzdWx0cyA9IHJlc3RhdXJhbnRzXHJcbiAgICAgICAgaWYgKGN1aXNpbmUgIT0gJ2FsbCcpIHtcclxuICAgICAgICAgIC8vIGZpbHRlciBieSBjdWlzaW5lXHJcbiAgICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIociA9PiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lKVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAobmVpZ2hib3Job29kICE9ICdhbGwnKSB7XHJcbiAgICAgICAgICAvLyBmaWx0ZXIgYnkgbmVpZ2hib3Job29kXHJcbiAgICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIociA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpXHJcbiAgICAgIH1cclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhbGwgbmVpZ2hib3Job29kcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hOZWlnaGJvcmhvb2RzKGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbClcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBHZXQgYWxsIG5laWdoYm9yaG9vZHMgZnJvbSBhbGwgcmVzdGF1cmFudHNcclxuICAgICAgICBjb25zdCBuZWlnaGJvcmhvb2RzID0gcmVzdGF1cmFudHMubWFwKFxyXG4gICAgICAgICAgKHYsIGkpID0+IHJlc3RhdXJhbnRzW2ldLm5laWdoYm9yaG9vZFxyXG4gICAgICAgIClcclxuICAgICAgICAvLyBSZW1vdmUgZHVwbGljYXRlcyBmcm9tIG5laWdoYm9yaG9vZHNcclxuICAgICAgICBjb25zdCB1bmlxdWVOZWlnaGJvcmhvb2RzID0gbmVpZ2hib3Job29kcy5maWx0ZXIoXHJcbiAgICAgICAgICAodiwgaSkgPT4gbmVpZ2hib3Job29kcy5pbmRleE9mKHYpID09IGlcclxuICAgICAgICApXHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgdW5pcXVlTmVpZ2hib3Job29kcylcclxuICAgICAgfVxyXG4gICAgfSlcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGFsbCBjdWlzaW5lcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hDdWlzaW5lcyhjYWxsYmFjaykge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpXHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gR2V0IGFsbCBjdWlzaW5lcyBmcm9tIGFsbCByZXN0YXVyYW50c1xyXG4gICAgICAgIGNvbnN0IGN1aXNpbmVzID0gcmVzdGF1cmFudHMubWFwKCh2LCBpKSA9PiByZXN0YXVyYW50c1tpXS5jdWlzaW5lX3R5cGUpXHJcbiAgICAgICAgLy8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBjdWlzaW5lc1xyXG4gICAgICAgIGNvbnN0IHVuaXF1ZUN1aXNpbmVzID0gY3Vpc2luZXMuZmlsdGVyKFxyXG4gICAgICAgICAgKHYsIGkpID0+IGN1aXNpbmVzLmluZGV4T2YodikgPT0gaVxyXG4gICAgICAgIClcclxuICAgICAgICBjYWxsYmFjayhudWxsLCB1bmlxdWVDdWlzaW5lcylcclxuICAgICAgfVxyXG4gICAgfSlcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlc3RhdXJhbnQgcGFnZSBVUkwuXHJcbiAgICovXHJcbiAgc3RhdGljIHVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xyXG4gICAgcmV0dXJuIGAuL3Jlc3RhdXJhbnQuaHRtbD9pZD0ke3Jlc3RhdXJhbnQuaWR9YFxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzdGF1cmFudCBpbWFnZSBVUkwuXHJcbiAgICovXHJcbiAgc3RhdGljIGltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XHJcbiAgICByZXR1cm4gYHB1YmxpYy9pbWcvJHtyZXN0YXVyYW50LmlkfS5qcGdgXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXN0YXVyYW50IGltYWdlIGFsdCB0YWdcclxuICAgKi9cclxuICBzdGF0aWMgaW1hZ2VBbHRmb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcclxuICAgIHJldHVybiByZXN0YXVyYW50LmltYWdlQWx0XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBNYXAgbWFya2VyIGZvciBhIHJlc3RhdXJhbnQuXHJcbiAgICovXHJcbiAgc3RhdGljIG1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgbWFwKSB7XHJcbiAgICAvLyBodHRwczovL2xlYWZsZXRqcy5jb20vcmVmZXJlbmNlLTEuMy4wLmh0bWwjbWFya2VyXHJcbiAgICBjb25zdCBtYXJrZXIgPSBuZXcgTC5tYXJrZXIoXHJcbiAgICAgIFtyZXN0YXVyYW50LmxhdGxuZy5sYXQsIHJlc3RhdXJhbnQubGF0bG5nLmxuZ10sXHJcbiAgICAgIHtcclxuICAgICAgICB0aXRsZTogcmVzdGF1cmFudC5uYW1lLFxyXG4gICAgICAgIGFsdDogcmVzdGF1cmFudC5uYW1lLFxyXG4gICAgICAgIHVybDogREJIZWxwZXIudXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KVxyXG4gICAgICB9XHJcbiAgICApXHJcbiAgICBtYXJrZXIuYWRkVG8obmV3TWFwKVxyXG4gICAgcmV0dXJuIG1hcmtlclxyXG4gIH1cclxuXHJcbiAgLypcclxuICAqIFNldCBhIHJlc3RhdXJhbnQgYXMgZmF2b3JpdGUgb3Igbm90XHJcbiAgKi9cclxuICBzdGF0aWMgc2VuZFRvZ2dsZUZhdihpZCwgYWRkKSB7XHJcbiAgICBpZiAobmF2aWdhdG9yLm9uTGluZSkge1xyXG4gICAgICBmZXRjaChgaHR0cDovL2xvY2FsaG9zdDoxMzM3L3Jlc3RhdXJhbnRzLyR7aWR9Lz9pc19mYXZvcml0ZT0ke2FkZH1gLCB7XHJcbiAgICAgICAgbWV0aG9kOiAnUFVUJyxcclxuICAgICAgICBtb2RlOiAnY29ycycsXHJcbiAgICAgICAgY2FjaGU6ICduby1jYWNoZScsXHJcbiAgICAgICAgY3JlZGVudGlhbHM6ICdzYW1lLW9yaWdpbicsXHJcbiAgICAgICAgaGVhZGVyczogbmV3IEhlYWRlcnMoeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH0pXHJcbiAgICAgIH0pXHJcbiAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4ge1xyXG4gICAgICAgICAgcmV0dXJuIHRoaXMuc2V0RmF2b3JpdGVMb2NhbERiKHtcclxuICAgICAgICAgICAgaWQ6IGlkLFxyXG4gICAgICAgICAgICBpc19mYXZvcml0ZTogYWRkXHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKCgpID0+IHtcclxuICAgICAgICAgIC8vIGNvbnNvbGUud2FybignWW91ciBhdHRlbXB0IHRvIGNvbnRhY3QgdGhlIHNlcnZlciBmYWlsZWQuIFN0b3JpbmcgbG9jYWxseSBhbmQgd2lsbCB0cnkgYWdhaW4gbGF0ZXIuJylcclxuICAgICAgICAgIHRoaXMuc2V0RmF2b3JpdGVMb2NhbERiKHtcclxuICAgICAgICAgICAgaWQ6IGlkIC0gMSxcclxuICAgICAgICAgICAgaXNfZmF2b3JpdGU6IGFkZFxyXG4gICAgICAgICAgfSlcclxuICAgICAgICB9KVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8gY29uc29sZS5pbmZvKCdZb3VyIGJyb3dzZXIgaXMgY3VycmVudGx5IG9mZmxpbmUuIFN0b3JpbmcgbG9jYWxseSBhbmQgd2lsbCB0cnkgYWdhaW4gbGF0ZXIuJylcclxuICAgICAgY29uc29sZS5sb2coaWQpXHJcbiAgICAgIGNvbnNvbGUubG9nKGFkZClcclxuICAgICAgdGhpcy5zZXRGYXZvcml0ZUxvY2FsRGIoe1xyXG4gICAgICAgIGlkOiBpZCxcclxuICAgICAgICBpc19mYXZvcml0ZTogYWRkXHJcbiAgICAgIH0pXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKlxyXG4gICogZ2V0IGZyb20gbG9jYWwgZGJcclxuICAqL1xyXG4gIHN0YXRpYyBmZXRjaExvY2FsRGIoc3RvcmUsIGtleSkge1xyXG4gICAgcmV0dXJuIHRoaXMuZGJQcm9taXNlXHJcbiAgICAgIC50aGVuKGRiID0+IHtcclxuICAgICAgICByZXR1cm4gZGIudHJhbnNhY3Rpb24oc3RvcmUpXHJcbiAgICAgICAgICAub2JqZWN0U3RvcmUoc3RvcmUpXHJcbiAgICAgICAgICAuZ2V0KGtleSlcclxuICAgICAgfSlcclxuICB9XHJcblxyXG4gIC8qXHJcbiAgKiBXcml0ZSBsaXN0IHRvIGxvY2FsIERCXHJcbiAgKi9cclxuICBzdGF0aWMgcHV0TG9jYWxEYihkYXRhLCBzdG9yZSwga2V5KSB7XHJcbiAgICB0aGlzLmRiUHJvbWlzZVxyXG4gICAgICAudGhlbihkYiA9PiB7XHJcbiAgICAgICAgZGIudHJhbnNhY3Rpb24oc3RvcmUsICdyZWFkd3JpdGUnKVxyXG4gICAgICAgICAgLm9iamVjdFN0b3JlKHN0b3JlKVxyXG4gICAgICAgICAgLnB1dChkYXRhLCBrZXkpXHJcbiAgICAgIH0pXHJcbiAgICAgIC5jYXRjaChlID0+IHtcclxuICAgICAgICBjb25zb2xlLmxvZyhlKVxyXG4gICAgICB9KVxyXG4gIH1cclxuXHJcbiAgLypcclxuICAqSGFuZGxlIGNoYW5naW5nIHJlc3RhdXJhbnQgYXMgZmF2b2lyaXRlIGluIGxvY2FsIERCXHJcbiAgKi9cclxuICBzdGF0aWMgc2V0RmF2b3JpdGVMb2NhbERiKHJlc3RhdXJhbnQpIHtcclxuICAgIC8vIHN0b3JlIHdob2xlIHJlc3BvbnNlIG9yIGp1c3QgY2hhbmdlIGF0dHIgaWYgdGhhdCdzIGl0XHJcbiAgICBjb25zdCBqc29uSW5kZXggPSByZXN0YXVyYW50LmlkIC0gMVxyXG4gICAgdGhpcy5mZXRjaExvY2FsRGIoJ3Jlc3RhdXJhbnRzJywgMClcclxuICAgICAgLnRoZW4ocmVzdGF1cmFudExpc3QgPT4ge1xyXG4gICAgICAgIHJlc3RhdXJhbnRMaXN0W2pzb25JbmRleF0uaXNfZmF2b3JpdGUgPSByZXN0YXVyYW50LmlzX2Zhdm9yaXRlXHJcbiAgICAgICAgdGhpcy5wdXRMb2NhbERiKHJlc3RhdXJhbnRMaXN0LCAncmVzdGF1cmFudHMnLCAwKVxyXG4gICAgICB9KVxyXG4gIH1cclxuXHJcbiAgLypcclxuICAqIEFkZCBhIHJldmlld1xyXG4gICovXHJcbiAgc3RhdGljIGFkZFJldmlldyhyZXZpZXcpIHtcclxuICAgIGlmIChuYXZpZ2F0b3Iub25MaW5lKSB7XHJcbiAgICAgIGZldGNoKCdodHRwOi8vbG9jYWxob3N0OjEzMzcvcmV2aWV3cy8nLCB7XHJcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgbW9kZTogJ2NvcnMnLFxyXG4gICAgICAgIGNhY2hlOiAnbm8tY2FjaGUnLFxyXG4gICAgICAgIGNyZWRlbnRpYWxzOiAnc2FtZS1vcmlnaW4nLFxyXG4gICAgICAgIGhlYWRlcnM6IG5ldyBIZWFkZXJzKHsgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyB9KSxcclxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShyZXZpZXcpXHJcbiAgICAgIH0pXHJcbiAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4ge1xyXG4gICAgICAgICAgLy8gY29uc29sZS53YXJuKCdZb3VyIGF0dGVtcHQgdG8gY29udGFjdCB0aGUgc2VydmVyIGZhaWxlZC4gU3RvcmluZyBsb2NhbGx5IGFuZCB3aWxsIHRyeSBhZ2FpbiBsYXRlci4nKVxyXG4gICAgICAgICAgdGhpcy5zdG9yZVJldmlld0xvY2FsRGIocmVzcG9uc2UpXHJcbiAgICAgICAgfSlcclxuICAgICAgICAuY2F0Y2goKCkgPT4ge1xyXG4gICAgICAgICAgdGhpcy5zdG9yZVJldmlld0xvY2FsRGIocmV2aWV3KVxyXG4gICAgICAgIH0pXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLnN0b3JlUmV2aWV3TG9jYWxEYihyZXZpZXcpXHJcbiAgICAgIC8vIGNvbnNvbGUuaW5mbygnWW91ciBicm93c2VyIGlzIGN1cnJlbnRseSBvZmZsaW5lLiBTdG9yaW5nIGxvY2FsbHkgYW5kIHdpbGwgdHJ5IGFnYWluIGxhdGVyLicpXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgc3RvcmVSZXZpZXdMb2NhbERiKHJldmlldykge1xyXG4gICAgY29uc3QgaWQgPSByZXZpZXcucmVzdGF1cmFudF9pZFxyXG4gICAgdGhpcy5mZXRjaExvY2FsRGIoJ3Jldmlld3MnLCBpZClcclxuICAgICAgLnRoZW4ocmV2aWV3TGlzdCA9PiB7XHJcbiAgICAgICAgcmV2aWV3TGlzdC5wdXNoKHJldmlldylcclxuICAgICAgICB0aGlzLnB1dExvY2FsRGIocmV2aWV3TGlzdCwgJ3Jldmlld3MnLCBpZClcclxuICAgICAgfSlcclxuICB9XHJcbn1cclxuIl19
