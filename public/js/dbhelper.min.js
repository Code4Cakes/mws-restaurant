"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var DBHelper=function(){function o(){_classCallCheck(this,o)}return _createClass(o,null,[{key:"fetchRestaurants",value:function(n){fetch("".concat(o.DATABASE_URL,"/restaurants")).then(function(e){if(200===e.status)e.json().then(function(e){n(null,e)});else{var t="Request failed. Returned status of ".concat(xhr.status);n(t,null)}}).catch(function(e){})}},{key:"fetchReviews",value:function(n){fetch("".concat(o.DATABASE_URL,"/reviews")).then(function(e){if(200===e.status)e.json().then(function(e){n(null,e)});else{var t="Request failed. Returned status of ".concat(xhr.status);n(t,null)}}).catch(function(e){})}},{key:"fetchRestaurantById",value:function(a,i){o.fetchRestaurants(function(e,t){if(e)i(e,null);else{var n=t.find(function(e){return e.id==a});n?i(null,n):i("Restaurant does not exist",null)}})}},{key:"fetchReviewsByRestaurantId",value:function(e,n){fetch("".concat(o.DATABASE_URL,"/reviews/?restaurant_id=").concat(e)).then(function(e){if(200===e.status)e.json().then(function(e){n(null,e)});else{var t="Request failed. Returned status of ".concat(xhr.status);n(t,null)}}).catch(function(e){})}},{key:"fetchRestaurantByCuisine",value:function(a,i){o.fetchRestaurants(function(e,t){if(e)i(e,null);else{var n=t.filter(function(e){return e.cuisine_type==a});i(null,n)}})}},{key:"fetchRestaurantByNeighborhood",value:function(a,i){o.fetchRestaurants(function(e,t){if(e)i(e,null);else{var n=t.filter(function(e){return e.neighborhood==a});i(null,n)}})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(a,i,r){o.fetchRestaurants(function(e,t){if(e)r(e,null);else{var n=t;"all"!=a&&(n=n.filter(function(e){return e.cuisine_type==a})),"all"!=i&&(n=n.filter(function(e){return e.neighborhood==i})),r(null,n)}})}},{key:"fetchNeighborhoods",value:function(i){o.fetchRestaurants(function(e,n){if(e)i(e,null);else{var a=n.map(function(e,t){return n[t].neighborhood}),t=a.filter(function(e,t){return a.indexOf(e)==t});i(null,t)}})}},{key:"fetchCuisines",value:function(i){o.fetchRestaurants(function(e,n){if(e)i(e,null);else{var a=n.map(function(e,t){return n[t].cuisine_type}),t=a.filter(function(e,t){return a.indexOf(e)==t});i(null,t)}})}},{key:"urlForRestaurant",value:function(e){return"./restaurant.html?id=".concat(e.id)}},{key:"imageUrlForRestaurant",value:function(e){return"public/img/".concat(e.id,".jpg")}},{key:"imageAltforRestaurant",value:function(e){return e.imageAlt}},{key:"mapMarkerForRestaurant",value:function(e,t){var n=new L.marker([e.latlng.lat,e.latlng.lng],{title:e.name,alt:e.name,url:o.urlForRestaurant(e)});return n.addTo(newMap),n}},{key:"sendToggleFav",value:function(t,n){var a=this;navigator.onLine?fetch("http://localhost:1337/restaurants/".concat(t,"/?is_favorite=").concat(n),{method:"PUT",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:new Headers({"Content-Type":"application/json"})}).then(function(e){a.setFavoriteLocalDb({id:t-1,is_favorite:n})}).catch(function(){a.setFavoriteLocalDb({id:t-1,is_favorite:n})}):this.setFavoriteLocalDb({id:t-1,is_favorite:n})}},{key:"addReview",value:function(t){var n=this;navigator.onLine?fetch("http://localhost:1337/reviews/",{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:new Headers({"Content-Type":"application/json"}),body:JSON.stringify(t)}).then(function(e){n.storeReviewLocalDb(t)}).catch(function(){n.storeReviewLocalDb(t)}):this.storeReviewLocalDb(t)}},{key:"storeReviewLocalDb",value:function(t){var n=this,a=t.restaurant_id;this.fetchLocalDb("reviews",a).then(function(e){e.push(t),n.putLocalDb(e,"reviews",a)})}},{key:"setFavoriteLocalDb",value:function(t){var n=this,a=t.id;this.fetchLocalDb("restaurants",0).then(function(e){e[a].is_favorite=t.is_favorite,n.putLocalDb(e,"restaurants",0)})}},{key:"fetchLocalDb",value:function(t,n){return this.dbPromise.then(function(e){return e.transaction(t).objectStore(t).get(n)})}},{key:"putLocalDb",value:function(t,n,a){this.dbPromise.then(function(e){e.transaction(n,"readwrite").objectStore(n).put(t,a)})}},{key:"DATABASE_URL",get:function(){return"http://localhost:".concat(1337)}},{key:"dbPromise",get:function(){return idb.open("restaurandDb",3,function(e){switch(e.oldVersion){case 0:e.createObjectStore("restaurants");case 1:e.createObjectStore("reviews")}})}}]),o}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRiaGVscGVyLmpzIl0sIm5hbWVzIjpbIkRCSGVscGVyIiwiY2FsbGJhY2siLCJmZXRjaCIsImNvbmNhdCIsIkRBVEFCQVNFX1VSTCIsInRoZW4iLCJyZXMiLCJzdGF0dXMiLCJqc29uIiwicmVzdGF1cmFudHMiLCJlcnJvciIsInhociIsImNhdGNoIiwicmV2aWV3cyIsImlkIiwiZmV0Y2hSZXN0YXVyYW50cyIsInJlc3RhdXJhbnQiLCJmaW5kIiwiciIsImN1aXNpbmUiLCJyZXN1bHRzIiwiZmlsdGVyIiwiY3Vpc2luZV90eXBlIiwibmVpZ2hib3Job29kIiwibmVpZ2hib3Job29kcyIsIm1hcCIsInYiLCJpIiwidW5pcXVlTmVpZ2hib3Job29kcyIsImluZGV4T2YiLCJjdWlzaW5lcyIsInVuaXF1ZUN1aXNpbmVzIiwiaW1hZ2VBbHQiLCJtYXJrZXIiLCJMIiwibGF0bG5nIiwibGF0IiwibG5nIiwidGl0bGUiLCJuYW1lIiwiYWx0IiwidXJsIiwidXJsRm9yUmVzdGF1cmFudCIsImFkZFRvIiwibmV3TWFwIiwiYWRkIiwiX3RoaXMiLCJ0aGlzIiwibmF2aWdhdG9yIiwib25MaW5lIiwibWV0aG9kIiwibW9kZSIsImNhY2hlIiwiY3JlZGVudGlhbHMiLCJoZWFkZXJzIiwiSGVhZGVycyIsIkNvbnRlbnQtVHlwZSIsInJlc3BvbnNlIiwic2V0RmF2b3JpdGVMb2NhbERiIiwiaXNfZmF2b3JpdGUiLCJyZXZpZXciLCJfdGhpczIiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsInN0b3JlUmV2aWV3TG9jYWxEYiIsIl90aGlzMyIsInJlc3RhdXJhbnRfaWQiLCJmZXRjaExvY2FsRGIiLCJyZXZpZXdMaXN0IiwicHVzaCIsInB1dExvY2FsRGIiLCJfdGhpczQiLCJqc29uSW5kZXgiLCJyZXN0YXVyYW50TGlzdCIsInN0b3JlIiwia2V5IiwiZGJQcm9taXNlIiwiZGIiLCJ0cmFuc2FjdGlvbiIsIm9iamVjdFN0b3JlIiwiZ2V0IiwiZGF0YSIsInB1dCIsImlk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Q2JDLFFBQVMsSUFBSUMsUUFBUSxDQUFFQyxlQUFnQixxQkFDdkNNLEtBQU1DLEtBQUtDLFVBQVVKLEtBRXBCdkQsS0FBSyxTQUFBb0QsR0FDSkksRUFBS0ksbUJBQW1CTCxLQUV6QmhELE1BQU0sV0FFTGlELEVBQUtJLG1CQUFtQkwsS0FHNUJiLEtBQUtrQixtQkFBbUJMLDhDQVFGQSxHQUFRLElBQUFNLEVBQUFuQixLQUMxQmpDLEVBQUs4QyxFQUFPTyxjQUVsQnBCLEtBQUtxQixhQUFhLFVBQVd0RCxHQUMxQlQsS0FBSyxTQUFBZ0UsR0FDSkEsRUFBV0MsS0FBS1YsR0FDaEJNLEVBQUtLLFdBQVdGLEVBQVksVUFBV3ZELGdEQU9uQkUsR0FBWSxJQUFBd0QsRUFBQXpCLEtBRTlCMEIsRUFBWXpELEVBQVdGLEdBQzdCaUMsS0FBS3FCLGFBQWEsY0FBZSxHQUM5Qi9ELEtBQUssU0FBQXFFLEdBQ0pBLEVBQWVELEdBQVdkLFlBQWMzQyxFQUFXMkMsWUFDbkRhLEVBQUtELFdBQVdHLEVBQWdCLGNBQWUsMENBT2pDQyxFQUFPQyxHQUN6QixPQUFPN0IsS0FBSzhCLFVBQ1R4RSxLQUFLLFNBQUF5RSxHQUNKLE9BQU9BLEVBQUdDLFlBQVlKLEdBQ25CSyxZQUFZTCxHQUNaTSxJQUFJTCx3Q0FPS00sRUFBTVAsRUFBT0MsR0FDN0I3QixLQUFLOEIsVUFDRnhFLEtBQUssU0FBQXlFLEdBQ0pBLEVBQUdDLFlBQVlKLEVBQU8sYUFDbkJLLFlBQVlMLEdBQ1pRLElBQUlELEVBQU1OLDBDQXZWakIsTUFBQSxvQkFBQXpFLE9BRGEsd0NBS2IsT0FBT2lGLElBQUlDLEtBQUssZUFBZ0IsRUFBRyxTQUFBQyxHQUNqQyxPQUFRQSxFQUFVQyxZQUNoQixLQUFLLEVBQ3FCRCxFQUFVRSxrQkFBa0IsZUFDdEQsS0FBSyxFQUNpQkYsRUFBVUUsa0JBQWtCIiwiZmlsZSI6ImRiaGVscGVyLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBDb21tb24gZGF0YWJhc2UgaGVscGVyIGZ1bmN0aW9ucy5cclxuICovXHJcbmNsYXNzIERCSGVscGVyIHtcclxuICAvKipcclxuICAgKiBEYXRhYmFzZSBVUkwuXHJcbiAgICogQ2hhbmdlIHRoaXMgdG8gcmVzdGF1cmFudHMuanNvbiBmaWxlIGxvY2F0aW9uIG9uIHlvdXIgc2VydmVyLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBnZXQgREFUQUJBU0VfVVJMKCkge1xyXG4gICAgY29uc3QgcG9ydCA9IDEzMzcgLy8gQ2hhbmdlIHRoaXMgdG8geW91ciBzZXJ2ZXIgcG9ydFxyXG4gICAgcmV0dXJuIGBodHRwOi8vbG9jYWxob3N0OiR7cG9ydH1gXHJcbiAgfVxyXG5cclxuICBzdGF0aWMgZ2V0IGRiUHJvbWlzZSgpIHtcclxuICAgIHJldHVybiBpZGIub3BlbigncmVzdGF1cmFuZERiJywgMywgdXBncmFkZURiID0+IHtcclxuICAgICAgc3dpdGNoICh1cGdyYWRlRGIub2xkVmVyc2lvbikge1xyXG4gICAgICAgIGNhc2UgMDpcclxuICAgICAgICAgIGNvbnN0IHJlc3RhdXJhbnRTdG9yZSA9IHVwZ3JhZGVEYi5jcmVhdGVPYmplY3RTdG9yZSgncmVzdGF1cmFudHMnKVxyXG4gICAgICAgIGNhc2UgMTpcclxuICAgICAgICAgIGNvbnN0IHJldmlld1N0b3JlID0gdXBncmFkZURiLmNyZWF0ZU9iamVjdFN0b3JlKCdyZXZpZXdzJylcclxuICAgICAgfVxyXG4gICAgfSlcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGFsbCByZXN0YXVyYW50cy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50cyhjYWxsYmFjaykge1xyXG4gICAgZmV0Y2goYCR7REJIZWxwZXIuREFUQUJBU0VfVVJMfS9yZXN0YXVyYW50c2ApLnRoZW4ocmVzID0+IHtcclxuICAgICAgaWYgKHJlcy5zdGF0dXMgPT09IDIwMCkge1xyXG4gICAgICAgIC8vIEdvdCBhIHN1Y2Nlc3MgcmVzcG9uc2UgZnJvbSBzZXJ2ZXIhXHJcbiAgICAgICAgcmVzLmpzb24oKS50aGVuKChyZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudHMpXHJcbiAgICAgICAgfSlcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBPb3BzIS4gR290IGFuIGVycm9yIGZyb20gc2VydmVyLlxyXG4gICAgICAgIGNvbnN0IGVycm9yID0gYFJlcXVlc3QgZmFpbGVkLiBSZXR1cm5lZCBzdGF0dXMgb2YgJHt4aHIuc3RhdHVzfWBcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbClcclxuICAgICAgfVxyXG4gICAgfSkuY2F0Y2goZXJyb3IgPT4ge1xyXG4gICAgICAvLyBjb25zb2xlLmxvZyhlcnJvcilcclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhbGwgcmV2aWV3cy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXZpZXdzKGNhbGxiYWNrKSB7XHJcbiAgICBmZXRjaChgJHtEQkhlbHBlci5EQVRBQkFTRV9VUkx9L3Jldmlld3NgKS50aGVuKHJlcyA9PiB7XHJcbiAgICAgIGlmIChyZXMuc3RhdHVzID09PSAyMDApIHtcclxuICAgICAgICAvLyBHb3QgYSBzdWNjZXNzIHJlc3BvbnNlIGZyb20gc2VydmVyIVxyXG5cclxuICAgICAgICByZXMuanNvbigpLnRoZW4oKHJldmlld3MpID0+IHtcclxuICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHJldmlld3MpXHJcbiAgICAgICAgfSlcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBPb3BzIS4gR290IGFuIGVycm9yIGZyb20gc2VydmVyLlxyXG4gICAgICAgIGNvbnN0IGVycm9yID0gYFJlcXVlc3QgZmFpbGVkLiBSZXR1cm5lZCBzdGF0dXMgb2YgJHt4aHIuc3RhdHVzfWBcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbClcclxuICAgICAgfVxyXG4gICAgfSkuY2F0Y2goZXJyb3IgPT4ge1xyXG4gICAgICAvLyBjb25zb2xlLmxvZyhlcnJvcilcclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhIHJlc3RhdXJhbnQgYnkgaXRzIElELlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUlkKGlkLCBjYWxsYmFjaykge1xyXG4gICAgLy8gZmV0Y2ggYWxsIHJlc3RhdXJhbnRzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnN0IHJlc3RhdXJhbnQgPSByZXN0YXVyYW50cy5maW5kKHIgPT4gci5pZCA9PSBpZClcclxuICAgICAgICBpZiAocmVzdGF1cmFudCkge1xyXG4gICAgICAgICAgLy8gR290IHRoZSByZXN0YXVyYW50XHJcbiAgICAgICAgICBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50KVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAvLyBSZXN0YXVyYW50IGRvZXMgbm90IGV4aXN0IGluIHRoZSBkYXRhYmFzZVxyXG4gICAgICAgICAgY2FsbGJhY2soJ1Jlc3RhdXJhbnQgZG9lcyBub3QgZXhpc3QnLCBudWxsKVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSlcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGFsbCByZXZpZXcgYnkgcmVzdGF1cmFudCBJRC5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXZpZXdzQnlSZXN0YXVyYW50SWQoaWQsIGNhbGxiYWNrKSB7XHJcbiAgICAvLyBmZXRjaCBhbGwgcmV2aWV3cyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgIGZldGNoKGAke0RCSGVscGVyLkRBVEFCQVNFX1VSTH0vcmV2aWV3cy8/cmVzdGF1cmFudF9pZD0ke2lkfWApXHJcbiAgICAgIC50aGVuKHJlcyA9PiB7XHJcbiAgICAgICAgaWYgKHJlcy5zdGF0dXMgPT09IDIwMCkge1xyXG4gICAgICAgICAgLy8gR290IGEgc3VjY2VzcyByZXNwb25zZSBmcm9tIHNlcnZlciFcclxuICAgICAgICAgIHJlcy5qc29uKCkudGhlbigocmV2aWV3cykgPT4ge1xyXG4gICAgICAgICAgICBjYWxsYmFjayhudWxsLCByZXZpZXdzKVxyXG4gICAgICAgICAgfSlcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgLy8gT29wcyEuIEdvdCBhbiBlcnJvciBmcm9tIHNlcnZlci5cclxuICAgICAgICAgIGNvbnN0IGVycm9yID0gYFJlcXVlc3QgZmFpbGVkLiBSZXR1cm5lZCBzdGF0dXMgb2YgJHt4aHIuc3RhdHVzfWBcclxuICAgICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKVxyXG4gICAgICAgIH1cclxuICAgICAgfSkuY2F0Y2goZXJyb3IgPT4ge1xyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKGVycm9yKVxyXG4gICAgICB9KVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBjdWlzaW5lIHR5cGUgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZShjdWlzaW5lLCBjYWxsYmFjaykge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzICB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZ1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIEZpbHRlciByZXN0YXVyYW50cyB0byBoYXZlIG9ubHkgZ2l2ZW4gY3Vpc2luZSB0eXBlXHJcbiAgICAgICAgY29uc3QgcmVzdWx0cyA9IHJlc3RhdXJhbnRzLmZpbHRlcihyID0+IHIuY3Vpc2luZV90eXBlID09IGN1aXNpbmUpXHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cylcclxuICAgICAgfVxyXG4gICAgfSlcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeU5laWdoYm9yaG9vZChuZWlnaGJvcmhvb2QsIGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbClcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBGaWx0ZXIgcmVzdGF1cmFudHMgdG8gaGF2ZSBvbmx5IGdpdmVuIG5laWdoYm9yaG9vZFxyXG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSByZXN0YXVyYW50cy5maWx0ZXIociA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpXHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cylcclxuICAgICAgfVxyXG4gICAgfSlcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSBhbmQgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChcclxuICAgIGN1aXNpbmUsXHJcbiAgICBuZWlnaGJvcmhvb2QsXHJcbiAgICBjYWxsYmFja1xyXG4gICkge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpXHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgbGV0IHJlc3VsdHMgPSByZXN0YXVyYW50c1xyXG4gICAgICAgIGlmIChjdWlzaW5lICE9ICdhbGwnKSB7XHJcbiAgICAgICAgICAvLyBmaWx0ZXIgYnkgY3Vpc2luZVxyXG4gICAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZSlcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG5laWdoYm9yaG9vZCAhPSAnYWxsJykge1xyXG4gICAgICAgICAgLy8gZmlsdGVyIGJ5IG5laWdoYm9yaG9vZFxyXG4gICAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kKVxyXG4gICAgICAgIH1cclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKVxyXG4gICAgICB9XHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYWxsIG5laWdoYm9yaG9vZHMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoTmVpZ2hib3Job29kcyhjYWxsYmFjaykge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpXHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gR2V0IGFsbCBuZWlnaGJvcmhvb2RzIGZyb20gYWxsIHJlc3RhdXJhbnRzXHJcbiAgICAgICAgY29uc3QgbmVpZ2hib3Job29kcyA9IHJlc3RhdXJhbnRzLm1hcChcclxuICAgICAgICAgICh2LCBpKSA9PiByZXN0YXVyYW50c1tpXS5uZWlnaGJvcmhvb2RcclxuICAgICAgICApXHJcbiAgICAgICAgLy8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBuZWlnaGJvcmhvb2RzXHJcbiAgICAgICAgY29uc3QgdW5pcXVlTmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHMuZmlsdGVyKFxyXG4gICAgICAgICAgKHYsIGkpID0+IG5laWdoYm9yaG9vZHMuaW5kZXhPZih2KSA9PSBpXHJcbiAgICAgICAgKVxyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHVuaXF1ZU5laWdoYm9yaG9vZHMpXHJcbiAgICAgIH1cclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhbGwgY3Vpc2luZXMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoQ3Vpc2luZXMoY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIEdldCBhbGwgY3Vpc2luZXMgZnJvbSBhbGwgcmVzdGF1cmFudHNcclxuICAgICAgICBjb25zdCBjdWlzaW5lcyA9IHJlc3RhdXJhbnRzLm1hcCgodiwgaSkgPT4gcmVzdGF1cmFudHNbaV0uY3Vpc2luZV90eXBlKVxyXG4gICAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gY3Vpc2luZXNcclxuICAgICAgICBjb25zdCB1bmlxdWVDdWlzaW5lcyA9IGN1aXNpbmVzLmZpbHRlcihcclxuICAgICAgICAgICh2LCBpKSA9PiBjdWlzaW5lcy5pbmRleE9mKHYpID09IGlcclxuICAgICAgICApXHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgdW5pcXVlQ3Vpc2luZXMpXHJcbiAgICAgIH1cclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXN0YXVyYW50IHBhZ2UgVVJMLlxyXG4gICAqL1xyXG4gIHN0YXRpYyB1cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcclxuICAgIHJldHVybiBgLi9yZXN0YXVyYW50Lmh0bWw/aWQ9JHtyZXN0YXVyYW50LmlkfWBcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlc3RhdXJhbnQgaW1hZ2UgVVJMLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBpbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xyXG4gICAgcmV0dXJuIGBwdWJsaWMvaW1nLyR7cmVzdGF1cmFudC5pZH0uanBnYFxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzdGF1cmFudCBpbWFnZSBhbHQgdGFnXHJcbiAgICovXHJcbiAgc3RhdGljIGltYWdlQWx0Zm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XHJcbiAgICByZXR1cm4gcmVzdGF1cmFudC5pbWFnZUFsdFxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogTWFwIG1hcmtlciBmb3IgYSByZXN0YXVyYW50LlxyXG4gICAqL1xyXG4gIHN0YXRpYyBtYXBNYXJrZXJGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIG1hcCkge1xyXG4gICAgLy8gaHR0cHM6Ly9sZWFmbGV0anMuY29tL3JlZmVyZW5jZS0xLjMuMC5odG1sI21hcmtlclxyXG4gICAgY29uc3QgbWFya2VyID0gbmV3IEwubWFya2VyKFxyXG4gICAgICBbcmVzdGF1cmFudC5sYXRsbmcubGF0LCByZXN0YXVyYW50LmxhdGxuZy5sbmddLFxyXG4gICAgICB7XHJcbiAgICAgICAgdGl0bGU6IHJlc3RhdXJhbnQubmFtZSxcclxuICAgICAgICBhbHQ6IHJlc3RhdXJhbnQubmFtZSxcclxuICAgICAgICB1cmw6IERCSGVscGVyLnVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudClcclxuICAgICAgfVxyXG4gICAgKVxyXG4gICAgbWFya2VyLmFkZFRvKG5ld01hcClcclxuICAgIHJldHVybiBtYXJrZXJcclxuICB9XHJcblxyXG4gIC8qXHJcbiAgKiBTZXQgYSByZXN0YXVyYW50IGFzIGZhdm9yaXRlIG9yIG5vdFxyXG4gICovXHJcbiAgc3RhdGljIHNlbmRUb2dnbGVGYXYoaWQsIGFkZCkge1xyXG5cclxuICAgIGlmIChuYXZpZ2F0b3Iub25MaW5lKSB7XHJcbiAgICAgIGZldGNoKGBodHRwOi8vbG9jYWxob3N0OjEzMzcvcmVzdGF1cmFudHMvJHtpZH0vP2lzX2Zhdm9yaXRlPSR7YWRkfWAsIHtcclxuICAgICAgICBtZXRob2Q6ICdQVVQnLFxyXG4gICAgICAgIG1vZGU6ICdjb3JzJyxcclxuICAgICAgICBjYWNoZTogJ25vLWNhY2hlJyxcclxuICAgICAgICBjcmVkZW50aWFsczogJ3NhbWUtb3JpZ2luJyxcclxuICAgICAgICBoZWFkZXJzOiBuZXcgSGVhZGVycyh7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicgfSlcclxuICAgICAgfSlcclxuICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7XHJcbiAgICAgICAgICB0aGlzLnNldEZhdm9yaXRlTG9jYWxEYih7XHJcbiAgICAgICAgICAgIGlkOiAoaWQgLSAxKSxcclxuICAgICAgICAgICAgaXNfZmF2b3JpdGU6IGFkZFxyXG4gICAgICAgICAgfSlcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5jYXRjaCgoKSA9PiB7XHJcbiAgICAgICAgICB0aGlzLnNldEZhdm9yaXRlTG9jYWxEYih7XHJcbiAgICAgICAgICAgIGlkOiAoaWQgLSAxKSxcclxuICAgICAgICAgICAgaXNfZmF2b3JpdGU6IGFkZFxyXG4gICAgICAgICAgfSlcclxuICAgICAgICB9KVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8gY29uc29sZS5pbmZvKCdZb3VyIGJyb3dzZXIgaXMgY3VycmVudGx5IG9mZmxpbmUuIFN0b3JpbmcgbG9jYWxseSBhbmQgd2lsbCB0cnkgYWdhaW4gbGF0ZXIuJylcclxuICAgICAgdGhpcy5zZXRGYXZvcml0ZUxvY2FsRGIoe1xyXG4gICAgICAgIGlkOiAoaWQgLSAxKSxcclxuICAgICAgICBpc19mYXZvcml0ZTogYWRkXHJcbiAgICAgIH0pXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKlxyXG4gICogQWRkIGEgcmV2aWV3XHJcbiAgKi9cclxuICBzdGF0aWMgYWRkUmV2aWV3KHJldmlldykge1xyXG4gICAgaWYgKG5hdmlnYXRvci5vbkxpbmUpIHtcclxuICAgICAgZmV0Y2goJ2h0dHA6Ly9sb2NhbGhvc3Q6MTMzNy9yZXZpZXdzLycsIHtcclxuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICBtb2RlOiAnY29ycycsXHJcbiAgICAgICAgY2FjaGU6ICduby1jYWNoZScsXHJcbiAgICAgICAgY3JlZGVudGlhbHM6ICdzYW1lLW9yaWdpbicsXHJcbiAgICAgICAgaGVhZGVyczogbmV3IEhlYWRlcnMoeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH0pLFxyXG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHJldmlldylcclxuICAgICAgfSlcclxuICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7XHJcbiAgICAgICAgICB0aGlzLnN0b3JlUmV2aWV3TG9jYWxEYihyZXZpZXcpXHJcbiAgICAgICAgfSlcclxuICAgICAgICAuY2F0Y2goKCkgPT4ge1xyXG4gICAgICAgICAgLy8gY29uc29sZS53YXJuKCdZb3VyIGF0dGVtcHQgdG8gY29udGFjdCB0aGUgc2VydmVyIGZhaWxlZC4gU3RvcmluZyBsb2NhbGx5IGFuZCB3aWxsIHRyeSBhZ2FpbiBsYXRlci4nKVxyXG4gICAgICAgICAgdGhpcy5zdG9yZVJldmlld0xvY2FsRGIocmV2aWV3KVxyXG4gICAgICAgIH0pXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLnN0b3JlUmV2aWV3TG9jYWxEYihyZXZpZXcpXHJcbiAgICAgIC8vIGNvbnNvbGUuaW5mbygnWW91ciBicm93c2VyIGlzIGN1cnJlbnRseSBvZmZsaW5lLiBTdG9yaW5nIGxvY2FsbHkgYW5kIHdpbGwgdHJ5IGFnYWluIGxhdGVyLicpXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKlxyXG4gICogaGFuZGxlIHRoZSBnZXQgYW5kIHB1dCBmb3IgbmV3IHJldmlld3NcclxuICAqL1xyXG4gIHN0YXRpYyBzdG9yZVJldmlld0xvY2FsRGIocmV2aWV3KSB7XHJcbiAgICBjb25zdCBpZCA9IHJldmlldy5yZXN0YXVyYW50X2lkXHJcblxyXG4gICAgdGhpcy5mZXRjaExvY2FsRGIoJ3Jldmlld3MnLCBpZClcclxuICAgICAgLnRoZW4ocmV2aWV3TGlzdCA9PiB7XHJcbiAgICAgICAgcmV2aWV3TGlzdC5wdXNoKHJldmlldylcclxuICAgICAgICB0aGlzLnB1dExvY2FsRGIocmV2aWV3TGlzdCwgJ3Jldmlld3MnLCBpZClcclxuICAgICAgfSlcclxuICB9XHJcblxyXG4gIC8qXHJcbiAgKkhhbmRsZSBjaGFuZ2luZyByZXN0YXVyYW50IGFzIGZhdm9pcml0ZSBpbiBsb2NhbCBEQlxyXG4gICovXHJcbiAgc3RhdGljIHNldEZhdm9yaXRlTG9jYWxEYihyZXN0YXVyYW50KSB7XHJcbiAgICAvLyBzdG9yZSB3aG9sZSByZXNwb25zZSBvciBqdXN0IGNoYW5nZSBhdHRyIGlmIHRoYXQncyBpdFxyXG4gICAgY29uc3QganNvbkluZGV4ID0gcmVzdGF1cmFudC5pZFxyXG4gICAgdGhpcy5mZXRjaExvY2FsRGIoJ3Jlc3RhdXJhbnRzJywgMClcclxuICAgICAgLnRoZW4ocmVzdGF1cmFudExpc3QgPT4ge1xyXG4gICAgICAgIHJlc3RhdXJhbnRMaXN0W2pzb25JbmRleF0uaXNfZmF2b3JpdGUgPSByZXN0YXVyYW50LmlzX2Zhdm9yaXRlXHJcbiAgICAgICAgdGhpcy5wdXRMb2NhbERiKHJlc3RhdXJhbnRMaXN0LCAncmVzdGF1cmFudHMnLCAwKVxyXG4gICAgICB9KVxyXG4gIH1cclxuXHJcbiAgLypcclxuICAqIGdldCBmcm9tIGxvY2FsIGRiXHJcbiAgKi9cclxuICBzdGF0aWMgZmV0Y2hMb2NhbERiKHN0b3JlLCBrZXkpIHtcclxuICAgIHJldHVybiB0aGlzLmRiUHJvbWlzZVxyXG4gICAgICAudGhlbihkYiA9PiB7XHJcbiAgICAgICAgcmV0dXJuIGRiLnRyYW5zYWN0aW9uKHN0b3JlKVxyXG4gICAgICAgICAgLm9iamVjdFN0b3JlKHN0b3JlKVxyXG4gICAgICAgICAgLmdldChrZXkpXHJcbiAgICAgIH0pXHJcbiAgfVxyXG5cclxuICAvKlxyXG4qIFdyaXRlIGxpc3QgdG8gbG9jYWwgREJcclxuKi9cclxuICBzdGF0aWMgcHV0TG9jYWxEYihkYXRhLCBzdG9yZSwga2V5KSB7XHJcbiAgICB0aGlzLmRiUHJvbWlzZVxyXG4gICAgICAudGhlbihkYiA9PiB7XHJcbiAgICAgICAgZGIudHJhbnNhY3Rpb24oc3RvcmUsICdyZWFkd3JpdGUnKVxyXG4gICAgICAgICAgLm9iamVjdFN0b3JlKHN0b3JlKVxyXG4gICAgICAgICAgLnB1dChkYXRhLCBrZXkpXHJcbiAgICAgIH0pXHJcbiAgfVxyXG5cclxufVxyXG4iXX0=
